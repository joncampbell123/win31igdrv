Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-1


					page	,132
				;-----------------------------Module-Header-----------------------------;
				; Module Name:	INPORT.ASM
				;
				; Windows mouse driver data and initialization routines for using an
				; InPort mouse for Windows
				;
				; Created: 21-Aug-1987
				; Author:  Mr. Mouse [mickeym], Walt Moore [waltm]
				;
				;  10-Jan-1990. -by-  Amit Chatterjee.
				;  If real mode, if INT 33 driver is loaded, we will try to get the mouse
				;  IRQ using an int 33 call. 
				;
				; Copyright (c) 1986,1987  Microsoft Corporation
				;
				; Exported Functions:
				;	None
				; Public Functions:
				;	inport_enable
				;	inport_disable
				;	inport_init
				; Public Data:
				;	None
				; General Description:
				;	This module contains the functions to find, enable, disable,
				;	and process interrupts for an InPort mouse
				;-----------------------------------------------------------------------;
				
				
					title	Microsoft Windows InPort Mouse Dependant Code
				
					.list
				
					??_out	InPort
				
				
					externNP hook_us_in		;Hook us into our interrupt
					externNP unhook_us		;Hook us out of our interrupt
					externNP enable_our_int 	;Enable us at the 8259
				
 = 023C				INPORT_IO_HIGH	equ	23Ch		;Highest possible base port address
 = 0230				INPORT_IO_LOW	equ	230h		;Lowest  possible base port address
 = 0004				INPORT_IO_SPAN	equ	4		;Spacing between base port addresses
				
 = 00BC				IRQ_PC_MASK_BITS equ	10111100b	;Search IRQs 7,5,4,3, and 2
				
				
 = 00B8				IRQ_AT_M_MASK_BITS equ	10111000b	;Search IRQs 7,5,4,3,
 = 0002				IRQ_AT_S_MASK_BITS equ	00000010b	;Search IRQ  9
				
				sBegin	Data
 0000                        2	_DATA segment 
				
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-2


				externB vector				;Vector # of mouse interrupt
				externB mask_8259			;8259 interrupt enable mask
				externB mouse_flags			;Various flags as follows
				externW io_base 			;Mouse port base address
				externW enable_proc			;Address of routine to	enable mouse
				externW disable_proc			;Address of routine to disable mouse
				externW WinFlags			;Windows exported flags
				externB device_int			;Start of mouse specific int handler
				externD event_proc			;Mouse event procedure when enabled
 0000  0000			OriginalCommPortAddr	dw	0	;addr of port whose int we will use
 0002  0000			OriginalCommAddrLoc	dw	0	;location in 40: for above address
				
				sEnd	Data
 0004                        1	_DATA ends 
				
				
				sBegin	Code
 0000                        2	_TEXT segment 
				assumes cs,Code
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-3


				page
				
				;	This is the start of the data which will be copied into
				;	the device_int area reserved in the data segment.
				
 = 0000				INPORT_START	equ	this word
				
				
				;--------------------------Interrupt-Routine----------------------------;
				; inport_int Mouse Interrupt Handler for the InPort Mouse
				;
				; This is the handler for the interrupt generated by the InPort
				; mouse.  It will reside in the Data segment starting at the
				; location device_int.
				;
				; Entry:
				;	None
				; Returns:
				;	None
				; Error Returns:
				;	None
				; Registers Preserved:
				;	ALL
				; Registers Destroyed:
				;	None
				; Calls:
				;	event_proc if a mouse event occured
				; History:
				;	Fri 21-Aug-1987 11:43:42 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes cs,Code
					assumes ds,nothing
					assumes es,nothing
					assumes ss,nothing
				
 = 0000				INPORT_PROC_START equ	$-INPORT_START	    ;Delta to this procedure
						  .errnz INPORT_PROC_START   ;Must be first
				
 0000				inport_int	proc	far
				
 0000  50				push	ax
 0001  53				push	bx
 0002  51				push	cx
 0003  52				push	dx
 0004  56				push	si
 0005  57				push	di
 0006  55				push	bp
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-4


 0007  1E				push	ds
 0008  06				push	es
 0009  B8 ---- R			mov	ax,_DATA
 000C  8E D8				mov	ds,ax
					assumes ds,Data
				
 000E  8B 16 0000 E			mov	dx,io_base		;--> Address register
 0012  B0 07				mov	al,INPORT_MODE		;Get access to mode register
 0014  EE				out	dx,al			;  and set the HOLD bit
 0015  42				inc	dx
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 0016  EB 00                 1		jmp	short $+2 
 0018  EB 00                 1		jmp	short $+2 
 001A  EB 00                 1		jmp	short $+2 
 001C  EC				in	al,dx
 001D  0C 20				or	al,INPORT_HOLD
					io_delay
 001F  EB 00                 1		jmp	short $+2 
 0021  EB 00                 1		jmp	short $+2 
 0023  EB 00                 1		jmp	short $+2 
 0025  EE				out	dx,al
				
 0026  B0 01				mov	al,INPORT_DATA_1	;Get delta X and save it
 0028  4A				dec	dx
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 0029  EB 00                 1		jmp	short $+2 
 002B  EB 00                 1		jmp	short $+2 
 002D  EB 00                 1		jmp	short $+2 
 002F  EE				out	dx,al
 0030  42				inc	dx
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 0031  EB 00                 1		jmp	short $+2 
 0033  EB 00                 1		jmp	short $+2 
 0035  EB 00                 1		jmp	short $+2 
 0037  EC				in	al,dx
 0038  98				cbw
 0039  93				xchg	bx,ax
				
 003A  B0 02				mov	al,INPORT_DATA_2	;Get delta Y and save it
 003C  4A				dec	dx
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 003D  EB 00                 1		jmp	short $+2 
 003F  EB 00                 1		jmp	short $+2 
 0041  EB 00                 1		jmp	short $+2 
 0043  EE				out	dx,al
 0044  42				inc	dx
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 0045  EB 00                 1		jmp	short $+2 
 0047  EB 00                 1		jmp	short $+2 
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-5


 0049  EB 00                 1		jmp	short $+2 
 004B  EC				in	al,dx
 004C  98				cbw
 004D  91				xchg	cx,ax
				
 004E  B0 00				mov	al,INPORT_MOUSE_STAT	;Get mouse status register
 0050  4A				dec	dx
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 0051  EB 00                 1		jmp	short $+2 
 0053  EB 00                 1		jmp	short $+2 
 0055  EB 00                 1		jmp	short $+2 
 0057  EE				out	dx,al
 0058  42				inc	dx
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 0059  EB 00                 1		jmp	short $+2 
 005B  EB 00                 1		jmp	short $+2 
 005D  EB 00                 1		jmp	short $+2 
 005F  EC				in	al,dx
 0060  86 C4				xchg	al,ah			;Save it here
				
 0062  B0 07				mov	al,INPORT_MODE		;Have all the info needed, clear
 0064  4A				dec	dx			;  the HOLD bit
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 0065  EB 00                 1		jmp	short $+2 
 0067  EB 00                 1		jmp	short $+2 
 0069  EB 00                 1		jmp	short $+2 
 006B  EE				out	dx,al
 006C  42				inc	dx
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
					io_delay
 006D  EB 00                 1		jmp	short $+2 
 006F  EB 00                 1		jmp	short $+2 
 0071  EB 00                 1		jmp	short $+2 
 0073  EC				in	al,dx
 0074  24 DF				and	al,not INPORT_HOLD
					io_delay
 0076  EB 00                 1		jmp	short $+2 
 0078  EB 00                 1		jmp	short $+2 
 007A  EB 00                 1		jmp	short $+2 
 007C  EE				out	dx,al
				
				
				;	The mouse is back and running.	Process the status to see what
				;	changed, and set up the return value.  Unlike the other mouse
				;	handlers which use a table lookup to determine if a button
				;	has changed state, in the general case it will be quicker
				;	to just test the delta flags and jump into the button code
				;	if a button changed.  Space costs are about the same.
				
				
 007D  86 C4				xchg	al,ah
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-6


 007F  32 E4				xor	ah,ah			;AH will accumulate delta state
 0081  D1 E0				shl	ax,1			;Align movement bit
 0083  D1 E0				shl	ax,1
					.errnz	INPORT_MOVEMENT-01000000b
					.errnz	SF_MOVEMENT-00000001b
				
 0085  A8 A0				test	al,(INPORT_DELTA_B1+INPORT_DELTA_B3) shl 2
 0087  75 2B				jnz	inport_button_changed	;At least one changed
				
 0089				inport_eoi:
 0089  B0 20				mov	al,EOI			;ACK the interrupt
 008B  F7 06 0000 E 0001		test	WinFlags,WF_PMODE
 0091  74 02				jz	no_slave
				
				;----------------------------------------------------------------------------;
				; CAUTION: It might not be a very good idea to EOI the slave if the mouse is ;
				; not on the slave.!!!							     ;
				;----------------------------------------------------------------------------;
				
 0093  E6 A0				out	ACK_SLAVE_PORT,al
 0095				no_slave:
 0095  E6 20				out	ACK_PORT,al
				
 0097  86 C4				xchg	al,ah			;Return delta and state in AX
 0099  98				cbw
 009A  0B C0				or	ax,ax
 009C  74 0C				jz	inport_no_data
 009E  BA 0002				mov	dx,NUMBER_BUTTONS
 00A1  33 F6			        xor     si,si			; Zero out MessageExtraInfo for 3.1
 00A3  33 FF			        xor     di,di
 00A5  FB				sti
 00A6  FF 1E 0000 E			call	event_proc
				
 00AA				inport_no_data:
 00AA  07				pop	es
 00AB  1F				pop	ds
 00AC  5D				pop	bp
 00AD  5F				pop	di
 00AE  5E				pop	si
 00AF  5A				pop	dx
 00B0  59				pop	cx
 00B1  5B				pop	bx
 00B2  58				pop	ax
				
 00B3				inport_int_exit:
 00B3  CF				iret
				
 00B4				inport_button_changed:			;At least one changed
 00B4  A8 80				test	al,INPORT_DELTA_B1 shl 2;Has button 1 changed?
 00B6  74 0E				jz	inport_button_2_changed ;  No, must have been other button
 00B8  80 CC 02				or	ah,SF_B1_DOWN		;  Yes, assume it is down
 00BB  A8 10				test	al,INPORT_STAT_B1 shl 2 ;  Is button 1 down?
 00BD  75 03				jnz	check_inport_button_2	;    Yes
 00BF  80 F4 06				xor	ah,SF_B1_DOWN+SF_B1_UP	;    No, it's up
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-7


				
 00C2				check_inport_button_2:
 00C2  A8 20				test	al,INPORT_DELTA_B3 shl 2;Has button 2 (SW3) changed?
 00C4  74 C3				jz	inport_eoi		;  No
				
 00C6				inport_button_2_changed:
 00C6  80 CC 08				or	ah,SF_B2_DOWN		;  Yes, assume it is down
 00C9  A8 04				test	al,INPORT_STAT_B3 shl 2 ;  Is button 3 down?
 00CB  75 BC				jnz	inport_eoi		;    Yes
 00CD  80 F4 18				xor	ah,SF_B2_DOWN+SF_B2_UP	;    No, it's up
 00D0  EB B7				jmp	inport_eoi
				
 00D2				inport_int	endp
				
 = 00D2				INPORT_INT_LENGTH = $-INPORT_START	;Length of code to copy
					.errnz	INPORT_INT_LENGTH gt MAX_INT_SIZE
				
				display_int_size  %INPORT_INT_LENGTH
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-8


				page
				
				;---------------------------Public-Routine------------------------------;
				; inport_search - Search for an InPort Pointer
				;
				; A search will be made for an InPort pointer.
				;
				; If an adapter is found but no interrupt is found, disable
				; searching for the bus mouse since this could cause the InPort
				; adapter to enter test mode, causing data contention on the bus.
				;
				; Entry:
				;	None
				; Returns:
				;	'C' set if found
				;	  CX = 0 if single interrupt vector was not found
				;	  CX = size of interrupt routine if interrupt vector found
				;	    AX = address of interrupt routine if interrupt vector found
				;	    SI = offset within the Code segment of the handler
				; Error Returns:
				;	'C' clear if not found
				; Registers Preserved:
				;	DS,ES,BP
				; Registers Destroyed:
				;	AX,BX,DX,FLAGS
				; Calls:
				;	inport_find_int
				; History:
				;	Fri 21-Aug-1987 11:43:42 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes cs,Code
					assumes ds,Data
				
						public	inport_search
 00D2				inport_search	proc	near
				
 00D2  BA 023E				mov	dx,INPORT_IO_HIGH+INPORT_ID
				
 00D5				inport_search_next:
 00D5  B4 DE				mov	ah,INPORT_CODE		;Don't want ID on the bus at all!
 00D7  EC				in	al,dx			;Read identification register
 00D8  3A C4				cmp	al,ah			;Check for inport ID code
 00DA  74 0F				je	possible_inport 	;Jump if might have found it
 00DC  EC				in	al,dx			;Port toggles between ID and
 00DD  3A C4				cmp	al,ah			;  version number
 00DF  74 0A				je	possible_inport
				
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-9


 00E1				inport_next_port:
 00E1  83 EA 04				sub	dx,INPORT_IO_SPAN	;Try next port, if there is one
 00E4  80 FA 2E				cmp	dl,low (INPORT_IO_LOW-INPORT_IO_SPAN+INPORT_ID)
 00E7  75 EC				jne	inport_search_next	;More ports exist to be checked
				;	clc				;('C' clear from compare)
 00E9  EB 3A				jmp	short inport_end_search ;'C' clear to show not found
				
				
				;	The correct response to the first inquiry was found.  Get the
				;	version/revision number.  Once that is done, then do it again
				;	to make sure this really is the chip we're looking at.
				
				
 00EB				possible_inport:
 00EB  EC				in	al,dx			;Read version/revision #
 00EC  8A D8				mov	bl,al			;Save version/revision # in BL
					io_delay
 00EE  EB 00                 1		jmp	short $+2 
 00F0  EB 00                 1		jmp	short $+2 
 00F2  EB 00                 1		jmp	short $+2 
 00F4  EC				in	al,dx			;Read type code
 00F5  3A C4				cmp	al,ah			;Check if type code still there
 00F7  75 E8				jne	inport_next_port	;Not really an inport device
 00F9  EC				in	al,dx			;Read version/revision #
 00FA  3A C3				cmp	al,bl			;Check version/revision #
 00FC  75 E3				jne	inport_next_port	;Not really an inport device
				
				
				;	Seems that a real Microsoft InPort Mouse has been found.
				;	Try to determine which interrupt vector its sitting on.
				
 00FE  83 EA 02				sub	dx,INPORT_ID		;--> base IO address for chip
 0101  52				push	dx			;Save base port address
 0102  E8 0126 R			call	inport_find_int
 0105  5A				pop	dx
 0106  B9 0000				mov	cx,0			;Don't destroy 'C'
 0109  72 1A				jc	inport_end_search	;None or multiple IRQs.  Show unusable
				
 010B  89 16 0000 E			mov	io_base,dx		;Save base IO address
 010F  B0 80				mov	al,INPORT_RESET 	;Reset chip, leaving interrupts
 0111  EE				out	dx,al			;  low
				
 0112  C7 06 0000 E 0255 R		mov	enable_proc,CodeOFFSET inport_enable
 0118  C7 06 0000 E 02A9 R		mov	disable_proc,CodeOFFSET inport_disable
 011E  BE 0000 R			mov	si,CodeOFFSET inport_int
 0121  B9 00D2				mov	cx,INPORT_INT_LENGTH
				
 0124				show_inport_found:
 0124  F9				stc				;Show inport device was found
				
 0125				inport_end_search:
 0125  C3				ret
				
 0126				inport_search	endp
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-10


				page
				
				;---------------------------Private-Routine-----------------------------;
				; inport_find_int - Find InPort Interrupt Vector
				;
				; An attempt will be made to find the interrupt vector that the
				; InPort adapter is set for.  The allowable vectors are 2,3,4,5, and 7.
				; If no interrupt vector is found, or more than one is found, then
				; an error will returned.
				;
				; Entry:
				;	DX = base port address
				; Returns:
				;	'C' clear if interrupt vector found
				;	 mask_8259 = interrupt mask
				;	 vector    = interrupt vector number
				; Error Returns:
				;	'C' set   if interrupt vector not found
				; Registers Preserved:
				;	SI,DI,DS,ES,BP
				; Registers Destroyed:
				;	AX,BX,CX,DX,FLAGS
				; Calls:
				;	None
				; History:
				;	Fri 21-Aug-1987 11:43:42 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes ds,Data
					assumes es,nothing
					assumes ss,nothing
				
						public	inport_find_int ;Public for debugging
 0126				inport_find_int proc	near
				
				; if this is a INT 33 type of mouse then try to get the IRQ number from 
				; the INT 33 driver.
				
 0126  F6 06 0000 E 02			test	mouse_flags,MF_INT33H
 012B  74 33				jz	int33_not_present	;it is not present
				
 012D  B8 0024				mov	ax,INT33H_GETINFO	;get info about mouse
 0130  CD 33				int	MOUSE_SYS_VEC		;CH has type & CL has IRQ
 0132  80 FD 03				cmp	ch,INT33H_INPORT	;make sure it is inport
 0135  75 29				jne	int33_not_present	;may be old driver
 0137  0A C9				or	cl,cl			;do not deal with IRQ = 0
 0139  74 25				jz	int33_not_present	;do alternate search
 013B  8A C1				mov	al,cl			;get the IRQ into AL
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-11


				
 013D  3C 02				cmp	al,2			;if it's IRQ 2 & we're in pMode
 013F  75 0A				jne	@f			;  then it's gotta be on the slave
 0141  F7 06 0000 E 0001		test	WinFlags,WF_PMODE	;  8259.  Use IRQ 9 vector in
 0147  74 02				jz	@f			;  that case.
 0149  B0 69				mov	al,71h - 8
 014B				@@:
 014B  04 08				add	al,08h			;map IRQ to INT vector number
 014D  B7 01				mov	bh,1			;initial position for IRQ mask
 014F  D2 E7				shl	bh,cl			;get inverse of the mask
 0151  F6 D7				not	bh			;get the correct mak
 0153  A2 0000 E			mov	vector,al		;Save interrupt vector #
 0156  88 3E 0000 E			mov	mask_8259,bh		;Save 8259 interrupt mask
 015A  E4 21				in	al,MASK_PORT		;--> old 8259 interrupt mask
 015C  50				push	ax			;Save old interrupt mask on stack
 015D  E9 0243 R			jmp	inport_search_done	;merge with alternate code
				
 0160				int33_not_present:
				
 0160  FA				cli				;Must leave ints off if we're
									;  going to restore the 8259
 0161  E4 21				in	al,MASK_PORT		;--> old 8259 interrupt mask
 0163  50				push	ax			;Save old interrupt mask on stack
 0164  B0 80				mov	al,INPORT_RESET 	;Reset chip
 0166  EE				out	dx,al
					io_delay
 0167  EB 00                 1		jmp	short $+2 
 0169  EB 00                 1		jmp	short $+2 
 016B  EB 00                 1		jmp	short $+2 
					io_delay
 016D  EB 00                 1		jmp	short $+2 
 016F  EB 00                 1		jmp	short $+2 
 0171  EB 00                 1		jmp	short $+2 
					io_delay
 0173  EB 00                 1		jmp	short $+2 
 0175  EB 00                 1		jmp	short $+2 
 0177  EB 00                 1		jmp	short $+2 
 0179  B0 07				mov	al,INPORT_MODE		;Select mode register
 017B  EE				out	dx,al			;  as the current data register
 017C  42				inc	dx			;Point to data register
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
				
 017D  B3 BC				mov	bl,IRQ_PC_MASK_BITS	;IRQ bits to search
 017F  F7 06 0000 E 0001		test	WinFlags,WF_PMODE	;Check for master and slave
 0185  74 02				jz	inport_no_protect
 0187  B3 B8				mov	bl,IRQ_AT_M_MASK_BITS	;IRQ bits to search
 0189				inport_no_protect:
 0189  8A C3				mov	al,bl			;Disable possible mouse IRQs
 018B  E6 21				out	MASK_PORT,al
					io_delay
 018D  EB 00                 1		jmp	short $+2 
 018F  EB 00                 1		jmp	short $+2 
 0191  EB 00                 1		jmp	short $+2 
 0193  B0 0A				mov	al,INT_REQUEST		;Select 8259 interrupt request reg
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-12


 0195  E6 20				out	ACK_PORT,al
				
 0197  8A E3				mov	ah,bl			;Possible interrupt bits
 0199  B9 000A				mov	cx,10			;Test 10 times max
				
 019C				inport_find_int_loop:
 019C  B0 10				mov	al,INPORT_TIMER_IE+INPORT_0
 019E  EE				out	dx,al			;Generate 0 on mouse IRQ
					io_delay
 019F  EB 00                 1		jmp	short $+2 
 01A1  EB 00                 1		jmp	short $+2 
 01A3  EB 00                 1		jmp	short $+2 
 01A5  E4 20				in	al,ACK_PORT		;Read interrupt bits
 01A7  22 C3				and	al,bl			;Make sure only bits 7,5,4,3,2
 01A9  32 C3				xor	al,bl			;Flip bits (0's-->1's & 1's-->0's)
 01AB  22 E0				and	ah,al			;Eliminate non-functional irq's
 01AD  74 28				jz	inport_no_irq		;All IRQ's eliminated
 01AF  B0 16				mov	al,INPORT_TIMER_IE+INPORT_1
 01B1  EE				out	dx,al			;Generate 1 on mouse IRQ
					io_delay
 01B2  EB 00                 1		jmp	short $+2 
 01B4  EB 00                 1		jmp	short $+2 
 01B6  EB 00                 1		jmp	short $+2 
 01B8  E4 20				in	al,ACK_PORT		;Read interrupt bits
 01BA  22 C3				and	al,bl			;Make sure only bits 7,5,4,3,2
 01BC  22 E0				and	ah,al			;Eliminate non-functional IRQ's
 01BE  74 17				jz	inport_no_irq		;All IRQ's eliminated
 01C0  E2 DA				loop	inport_find_int_loop
				
 01C2  32 DB				xor	bl,bl			;BL will end up with the # of IRQ's
 01C4  8A FC				mov	bh,ah			;--> IRQ bit
 01C6  B9 0007				mov	cx,7			;Loop counter and IRQ #
				
 01C9				inport_count_irqs:
 01C9  D0 E4				shl	ah,1			;Set 'C' if IRQ responded correctly
 01CB  73 04				jnc	inport_next_irq
 01CD  8A C1				mov	al,cl			;Save IRQ #
 01CF  FE C3				inc	bl			;Increment # of IRQ's
				
 01D1				inport_next_irq:
 01D1  E2 F6				loop	inport_count_irqs
 01D3  FE CB				dec	bl			;More than 1 IRQ ?
 01D5  74 60				jz	inport_found_irq	;Only 1 IRQ
				
 01D7				inport_no_irq:
 01D7  F7 06 0000 E 0001		test	WinFlags,WF_PMODE
 01DD  75 03				jnz	inport_check_slave
 01DF  F9				stc				;Set 'C' to indicate no interrupt
 01E0  EB 61				jmp	short inport_search_done
				
 01E2				inport_check_slave:
 01E2  E4 A1				in	al,MASK_SLAVE_PORT	;--> old 8259 interrupt mask
 01E4  50				push	ax			;Save old interrupt mask on stack
				
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-13


 01E5  B3 02				mov	bl,IRQ_AT_S_MASK_BITS	;IRQ bits to search
 01E7  8A C3				mov	al,bl			;Disable possible mouse IRQs
 01E9  E6 A1				out	MASK_SLAVE_PORT,al
					io_delay
 01EB  EB 00                 1		jmp	short $+2 
 01ED  EB 00                 1		jmp	short $+2 
 01EF  EB 00                 1		jmp	short $+2 
 01F1  B0 0A				mov	al,INT_REQUEST		;Select 8259 interrupt request reg
 01F3  E6 A0				out	ACK_SLAVE_PORT,al
				
 01F5  8A E3				mov	ah,bl			;Possible interrupt bits
 01F7  B9 000A				mov	cx,10			;Test 10 times max
				
 01FA				inport_find_slave_int_loop:
 01FA  B0 10				mov	al,INPORT_TIMER_IE+INPORT_0
 01FC  EE				out	dx,al			;Generate 0 on mouse IRQ
					io_delay
 01FD  EB 00                 1		jmp	short $+2 
 01FF  EB 00                 1		jmp	short $+2 
 0201  EB 00                 1		jmp	short $+2 
 0203  E4 A0				in	al,ACK_SLAVE_PORT	;Read interrupt bits
 0205  22 C3				and	al,bl			;Make sure only bits 7,5,4,3,2
 0207  32 C3				xor	al,bl			;Flip bits (0's-->1's & 1's-->0's)
 0209  22 E0				and	ah,al			;Eliminate non-functional irq's
 020B  74 16				jz	inport_no_slave_irq	;All IRQ's eliminated
 020D  B0 16				mov	al,INPORT_TIMER_IE+INPORT_1
 020F  EE				out	dx,al			;Generate 1 on mouse IRQ
					io_delay
 0210  EB 00                 1		jmp	short $+2 
 0212  EB 00                 1		jmp	short $+2 
 0214  EB 00                 1		jmp	short $+2 
 0216  E4 A0				in	al,ACK_SLAVE_PORT	;Read interrupt bits
 0218  22 C3				and	al,bl			;Make sure only bits 7,5,4,3,2
 021A  22 E0				and	ah,al			;Eliminate non-functional IRQ's
 021C  74 05				jz	inport_no_slave_irq	;All IRQ's eliminated
 021E  E2 DA				loop	inport_find_slave_int_loop
				
 0220  F8				clc
 0221  EB 01				jmp	short inport_found_slave_irq
				
 0223				inport_no_slave_irq:
 0223  F9				stc				;Set 'C' to indicate no interrupt
 0224				inport_found_slave_irq:
 0224  B0 0B				mov	al,IN_SERVICE		;Restore 8259 slave
					io_delay
 0226  EB 00                 1		jmp	short $+2 
 0228  EB 00                 1		jmp	short $+2 
 022A  EB 00                 1		jmp	short $+2 
 022C  E6 A0				out	ACK_SLAVE_PORT,al
 022E  58				pop	ax			;Restore old 8259 interrupt mask
 022F  E6 A1				out	MASK_SLAVE_PORT,al
 0231  72 10				jc	short inport_search_done
 0233  B7 04				mov	bh,00000100b
 0235  B0 69				mov	al,71h - 8
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-14


				
 0237				inport_found_irq:
 0237  04 08				add	al,8			;Compute interrupt vector #
 0239  A2 0000 E			mov	vector,al		;Save interrupt vector #
 023C  F6 D7				not	bh			;Want an enable mask
 023E  88 3E 0000 E			mov	mask_8259,bh		;Save 8259 interrupt mask
 0242  F8				clc
				
 0243				inport_search_done:
 0243  B0 00				mov	al,0			;Must preserve 'C'
 0245  EE				out	dx,al			;Tri-state the IRQ line
 0246  B0 0B				mov	al,IN_SERVICE		;Restore 8259
					io_delay
 0248  EB 00                 1		jmp	short $+2 
 024A  EB 00                 1		jmp	short $+2 
 024C  EB 00                 1		jmp	short $+2 
 024E  E6 20				out	ACK_PORT,al
 0250  58				pop	ax			;Restore old 8259 interrupt mask
 0251  E6 21				out	MASK_PORT,al
 0253  FB				sti				;Allow interrupts now
 0254  C3				ret
				
 0255				inport_find_int endp
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-15


				page
				
				;---------------------------Private-Routine-----------------------------;
				; inport_enable - Enable InPort Mouse
				;
				; The InPort mouse will be initialized, the interrupt vector hooked,
				; the old interrupt mask saved, and our interrupt enabled at the 8259.
				;
				; Entry:
				;	None
				; Returns:
				;	None
				; Error Returns:
				;	None
				; Registers Preserved:
				;	SI,DI,DS,ES,BP
				; Registers Destroyed:
				;	AX,BX,CX,DX,FLAGS
				; Calls:
				;	hook_us_in
				;	enable_our_int
				; History:
				;	Fri 21-Aug-1987 11:43:42 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes ds,Data
					assumes es,nothing
					assumes ss,nothing
				
						public	inport_enable	;Public for debugging
 0255				inport_enable	proc	near
				
 0255  E8 0000 E			call	hook_us_in		;Hook us into the interrupt
				
				; if the vector that we are using for the Mouse INT matches either of the 
				; serial int vectors 0bh or 0ch, we will then have to NULL out the 
				; corresponding serial port address in the BIOS data area so that no one
				; will try to use those ports.
				
 0258  06				push	es			;save
 0259  BB ---- R			mov	bx,BIOSDataSeg		;segment for BIOS data
 025C  8E C3				mov	es,bx			;es: points to BIOS data
					assumes es,BIOSDataSeg
 025E  33 C0				xor	ax,ax			;will put in zero there
 0260  BB 0000 R			mov	bx,offset rs232_data	;Start of serial ports
 0263  80 3E 0000 E 0C			cmp	vector,0ch		;using COMM 1's int ?
 0268  74 0A				jz	zero_out_comm_port_addr	;yes
 026A  83 C3 02				add	bx,2			;may be comm 2
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-16


 026D  80 3E 0000 E 0B			cmp	vector,0bh		;COMM 2's int ?
 0272  75 03				jnz	save_comm_port_addr	;do not do anything
				
 0274				zero_out_comm_port_addr:
				
 0274  26: 87 07			xchg	es:[bx],ax		;get previous port addr too.
				
 0277				save_comm_port_addr:
				
 0277  A3 0000 R			mov	OriginalCommPortAddr,ax	;if zero then was not swapped
 027A  89 1E 0002 R			mov	OriginalCommAddrLoc,bx	;also save the location in 40:
 027E  07				pop	es			;restore
					assumes	es,nothing
				
 027F  8B 16 0000 E			mov	dx,io_base		;Initialize the InPort Mouse
 0283  B0 80				mov	al,INPORT_RESET 	;Reset chip
 0285  EE				out	dx,al
					io_delay
 0286  EB 00                 1		jmp	short $+2 
 0288  EB 00                 1		jmp	short $+2 
 028A  EB 00                 1		jmp	short $+2 
					io_delay
 028C  EB 00                 1		jmp	short $+2 
 028E  EB 00                 1		jmp	short $+2 
 0290  EB 00                 1		jmp	short $+2 
					io_delay
 0292  EB 00                 1		jmp	short $+2 
 0294  EB 00                 1		jmp	short $+2 
 0296  EB 00                 1		jmp	short $+2 
				
 0298  B0 07				mov	al,INPORT_MODE		;Select mode register
 029A  EE				out	dx,al			;  as the current data register
 029B  42				inc	dx			;Point to data register
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
				
					io_delay
 029C  EB 00                 1		jmp	short $+2 
 029E  EB 00                 1		jmp	short $+2 
 02A0  EB 00                 1		jmp	short $+2 
 02A2  B0 11				mov	al,INPORT_TIMER_IE+INPORT_HZ_30+INPORT_QUAD
 02A4  EE				out	dx,al
				
 02A5  E8 0000 E			call	enable_our_int
 02A8  C3				ret
				
 02A9				inport_enable	endp
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-17


				page
				
				;---------------------------Private-Routine-----------------------------;
				; inport_disable - Disable InPort Mouse
				;
				; The interrupt vector will be restored, the old interrupt mask
				; restored at the 8259.  If the old mask shows that the mouse was
				; previously enabled, it will remain enabled, else we will disable
				; interrupts at the mouse itself.
				;
				; Entry:
				;	None
				; Returns:
				;	None
				; Error Returns:
				;	None
				; Registers Preserved:
				;	SI,DI,DS,ES,BP
				; Registers Destroyed:
				;	AX,BX,CX,DX,FLAGS
				; Calls:
				;	unhook_us
				; History:
				;	Fri 21-Aug-1987 11:43:42 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes ds,Data
					assumes es,nothing
					assumes ss,nothing
				
						public	inport_disable	;Public for debugging
 02A9				inport_disable	proc	near
				
				;	Disable interrupts first so no interrupt will hit if
				;	only the BIOS default handler is around.
				
 02A9  8B 16 0000 E			mov	dx,io_base		;Disable IRQs at the mouse
 02AD  B0 07				mov	al,INPORT_MODE		;Select mode register
 02AF  EE				out	dx,al			;  as the current data register
 02B0  42				inc	dx			;Point to data register
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
 02B1  B0 00				mov	al,INPORT_QUAD+INPORT_0 ;Just leave it in quadrature mode
 02B3  EE				out	dx,al			;  with IRQ low
				
				; now if we had zeroed out one of the comm port addresses in the bios data
				; area, restore it.
				
 02B4  A1 0000 R			mov	ax,OriginalCommPortAddr	;get the original address ?
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Page     1-18


 02B7  0B C0				or	ax,ax			;was it zero or not put at all ?
 02B9  74 0E				jz	@f			;yes,no need to put it back
 02BB  06				push	es			;save
 02BC  BB ---- R			mov	bx,BIOSDataSeg		;seg value for BIOS data area
 02BF  8E C3				mov	es,bx			;es: points to BIOS data area
					assumes es,BIOSDataSeg
 02C1  8B 1E 0002 R			mov	bx,OriginalCommAddrLoc	;location of the address
 02C5  26: 89 07			mov	es:[bx],ax		;restore it
 02C8  07				pop	es			;restore
					assumes	es,nothing
 02C9				@@:
				
 02C9  E8 0000 E			call	unhook_us		;Restore everything to what it was
 02CC  75 26				jnz	inport_disable_exit	;IRQ was previously disabled
				
				
 02CE  8B 16 0000 E			mov	dx,io_base		;Initialize the InPort Mouse
 02D2  B0 80				mov	al,INPORT_RESET 	;Reset chip
 02D4  EE				out	dx,al
					io_delay
 02D5  EB 00                 1		jmp	short $+2 
 02D7  EB 00                 1		jmp	short $+2 
 02D9  EB 00                 1		jmp	short $+2 
					io_delay
 02DB  EB 00                 1		jmp	short $+2 
 02DD  EB 00                 1		jmp	short $+2 
 02DF  EB 00                 1		jmp	short $+2 
					io_delay
 02E1  EB 00                 1		jmp	short $+2 
 02E3  EB 00                 1		jmp	short $+2 
 02E5  EB 00                 1		jmp	short $+2 
				
 02E7  B0 07				mov	al,INPORT_MODE		;Select mode register
 02E9  EE				out	dx,al			;  as the current data register
 02EA  42				inc	dx			;Point to data register
					.errnz	INPORT_DATA_REG-INPORT_ADDR_PTR-1
				
					io_delay
 02EB  EB 00                 1		jmp	short $+2 
 02ED  EB 00                 1		jmp	short $+2 
 02EF  EB 00                 1		jmp	short $+2 
 02F1  B0 11				mov	al,INPORT_TIMER_IE+INPORT_HZ_30+INPORT_QUAD
 02F3  EE				out	dx,al
				
 02F4				inport_disable_exit:
 02F4  C3				ret
				
 02F5				inport_disable	endp
				
				
				sEnd	Code
 02F5                        1	_TEXT ends 
				end

Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Symbols-1


Macros:

		N a m e			Lines

display_int_size . . . . . . . .  	   3
io_delay . . . . . . . . . . . .  	   3

Segments and Groups:

                N a m e         	Length	 Align	Combine Class

BIOSDataSeg  . . . . . . . . . .  	006D	AT	0040	
DGROUP . . . . . . . . . . . . .  	GROUP
  _DATA  . . . . . . . . . . . .  	0004	WORD	PUBLIC	'DATA'
_TEXT  . . . . . . . . . . . . .  	02F5	WORD	PUBLIC	'CODE'

Symbols:            

                N a m e         	Type	 Value	 Attr

ACK_PORT . . . . . . . . . . . .  	NUMBER	0020	
ACK_SLAVE_PORT . . . . . . . . .  	NUMBER	00A0	

BASH_INT_PROC  . . . . . . . . .  	NUMBER	000C	
bios_time  . . . . . . . . . . .  	L BYTE	006C	BIOSDataSeg
bptr . . . . . . . . . . . . . .  	TEXT  byte ptr		

CALL_ON_ANY_INT  . . . . . . . .  	NUMBER	001F	
CLEAR_COUNTERS . . . . . . . . .  	NUMBER	000B	
CodeBASE . . . . . . . . . . . .  	ALIAS	 _TEXT		
CodeOFFSET . . . . . . . . . . .  	TEXT  offset _TEXT:		
check_inport_button_2  . . . . .  	L NEAR	00C2	_TEXT

DataBASE . . . . . . . . . . . .  	ALIAS	 DGROUP		
DataOFFSET . . . . . . . . . . .  	TEXT  offset DGROUP:		
device_int . . . . . . . . . . .  	V BYTE	0000	_DATA	External
disable_proc . . . . . . . . . .  	V WORD	0000	_DATA	External
dptr . . . . . . . . . . . . . .  	TEXT  dword ptr		

EOI  . . . . . . . . . . . . . .  	NUMBER	0020	
enable_our_int . . . . . . . . .  	L NEAR	0000		External
enable_proc  . . . . . . . . . .  	V WORD	0000	_DATA	External
event_proc . . . . . . . . . . .  	V DWORD	0000	_DATA	External

hook_us_in . . . . . . . . . . .  	L NEAR	0000		External

INPORT_0 . . . . . . . . . . . .  	NUMBER	0000	
INPORT_1 . . . . . . . . . . . .  	NUMBER	0006	
INPORT_ABS . . . . . . . . . . .  	NUMBER	0080	
INPORT_ADDR  . . . . . . . . . .  	NUMBER	0007	
INPORT_ADDR_PTR  . . . . . . . .  	NUMBER	0000	
INPORT_CODE  . . . . . . . . . .  	NUMBER	00DE	
INPORT_CONTROL . . . . . . . . .  	NUMBER	0006	
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Symbols-2


INPORT_DATA_1  . . . . . . . . .  	NUMBER	0001	
INPORT_DATA_2  . . . . . . . . .  	NUMBER	0002	
INPORT_DATA_3  . . . . . . . . .  	NUMBER	0003	
INPORT_DATA_4  . . . . . . . . .  	NUMBER	0004	
INPORT_DATA_IE . . . . . . . . .  	NUMBER	0008	
INPORT_DATA_REG  . . . . . . . .  	NUMBER	0001	
INPORT_DELTA_B1  . . . . . . . .  	NUMBER	0020	
INPORT_DELTA_B2  . . . . . . . .  	NUMBER	0010	
INPORT_DELTA_B3  . . . . . . . .  	NUMBER	0008	
INPORT_DIRECT  . . . . . . . . .  	NUMBER	00C0	
INPORT_EXT_CLK . . . . . . . . .  	NUMBER	0007	
INPORT_HOLD  . . . . . . . . . .  	NUMBER	0020	
INPORT_HZ_100  . . . . . . . . .  	NUMBER	0003	
INPORT_HZ_200  . . . . . . . . .  	NUMBER	0004	
INPORT_HZ_30 . . . . . . . . . .  	NUMBER	0001	
INPORT_HZ_50 . . . . . . . . . .  	NUMBER	0002	
INPORT_ID  . . . . . . . . . . .  	NUMBER	0002	
INPORT_INT_LENGTH  . . . . . . .  	NUMBER	00D2	
INPORT_IO_HIGH . . . . . . . . .  	NUMBER	023C	
INPORT_IO_LOW  . . . . . . . . .  	NUMBER	0230	
INPORT_IO_SPAN . . . . . . . . .  	NUMBER	0004	
INPORT_MODE  . . . . . . . . . .  	NUMBER	0007	
INPORT_MODE_SEL  . . . . . . . .  	NUMBER	00C0	
INPORT_MOUSE_STAT  . . . . . . .  	NUMBER	0000	
INPORT_MOVEMENT  . . . . . . . .  	NUMBER	0040	
INPORT_MSX . . . . . . . . . . .  	NUMBER	0040	
INPORT_NIBBLE_1  . . . . . . . .  	NUMBER	00F0	
INPORT_NIBBLE_2  . . . . . . . .  	NUMBER	000F	
INPORT_NIBBLE_3  . . . . . . . .  	NUMBER	00F0	
INPORT_NIBBLE_4  . . . . . . . .  	NUMBER	000F	
INPORT_NIBBLE_5  . . . . . . . .  	NUMBER	00F0	
INPORT_NIBBLE_6  . . . . . . . .  	NUMBER	000F	
INPORT_NIBBLE_7  . . . . . . . .  	NUMBER	00F0	
INPORT_NIBBLE_8  . . . . . . . .  	NUMBER	000F	
INPORT_PACKET  . . . . . . . . .  	NUMBER	0080	
INPORT_PROC_START  . . . . . . .  	NUMBER	0000	
INPORT_QUAD  . . . . . . . . . .  	NUMBER	0000	
INPORT_RESET . . . . . . . . . .  	NUMBER	0080	
INPORT_REVISION  . . . . . . . .  	NUMBER	000F	
INPORT_START . . . . . . . . . .  	WORD	0000	_TEXT
INPORT_STATE_SW1 . . . . . . . .  	NUMBER	0004	
INPORT_STATE_SW2 . . . . . . . .  	NUMBER	0002	
INPORT_STATE_SW3 . . . . . . . .  	NUMBER	0001	
INPORT_STATE_XA  . . . . . . . .  	NUMBER	0010	
INPORT_STATE_XB  . . . . . . . .  	NUMBER	0020	
INPORT_STATE_YA  . . . . . . . .  	NUMBER	0040	
INPORT_STATE_YB  . . . . . . . .  	NUMBER	0080	
INPORT_STATUS  . . . . . . . . .  	NUMBER	0005	
INPORT_STAT_B1 . . . . . . . . .  	NUMBER	0004	
INPORT_STAT_B2 . . . . . . . . .  	NUMBER	0002	
INPORT_STAT_B3 . . . . . . . . .  	NUMBER	0001	
INPORT_SW1 . . . . . . . . . . .  	NUMBER	0004	
INPORT_SW2 . . . . . . . . . . .  	NUMBER	0002	
INPORT_SW3 . . . . . . . . . . .  	NUMBER	0001	
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Symbols-3


INPORT_TIMER . . . . . . . . . .  	NUMBER	0007	
INPORT_TIMER_IE  . . . . . . . .  	NUMBER	0010	
INPORT_VERSION . . . . . . . . .  	NUMBER	00F0	
INPORT_XA  . . . . . . . . . . .  	NUMBER	0010	
INPORT_XB  . . . . . . . . . . .  	NUMBER	0020	
INPORT_X_MOVE  . . . . . . . . .  	NUMBER	00FF	
INPORT_YA  . . . . . . . . . . .  	NUMBER	0040	
INPORT_YB  . . . . . . . . . . .  	NUMBER	0080	
INPORT_Y_MOVE  . . . . . . . . .  	NUMBER	00FF	
INT33H_BUS . . . . . . . . . . .  	NUMBER	0001	
INT33H_ENABLE  . . . . . . . . .  	NUMBER	0020	
INT33H_GETINFO . . . . . . . . .  	NUMBER	0024	
INT33H_HP  . . . . . . . . . . .  	NUMBER	0005	
INT33H_INPORT  . . . . . . . . .  	NUMBER	0003	
INT33H_PS_2  . . . . . . . . . .  	NUMBER	0004	
INT33H_RESET . . . . . . . . . .  	NUMBER	0000	
INT33H_SERIAL  . . . . . . . . .  	NUMBER	0002	
INT_REQUEST  . . . . . . . . . .  	NUMBER	000A	
IN_SERVICE . . . . . . . . . . .  	NUMBER	000B	
IRQ_AT_M_MASK_BITS . . . . . . .  	NUMBER	00B8	
IRQ_AT_S_MASK_BITS . . . . . . .  	NUMBER	0002	
IRQ_PC_MASK_BITS . . . . . . . .  	NUMBER	00BC	
inport_button_2_changed  . . . .  	L NEAR	00C6	_TEXT
inport_button_changed  . . . . .  	L NEAR	00B4	_TEXT
inport_check_slave . . . . . . .  	L NEAR	01E2	_TEXT
inport_count_irqs  . . . . . . .  	L NEAR	01C9	_TEXT
inport_disable . . . . . . . . .  	N PROC	02A9	_TEXT	Global	Length = 004C
inport_disable_exit  . . . . . .  	L NEAR	02F4	_TEXT
inport_enable  . . . . . . . . .  	N PROC	0255	_TEXT	Global	Length = 0054
inport_end_search  . . . . . . .  	L NEAR	0125	_TEXT
inport_eoi . . . . . . . . . . .  	L NEAR	0089	_TEXT
inport_find_int  . . . . . . . .  	N PROC	0126	_TEXT	Global	Length = 012F
inport_find_int_loop . . . . . .  	L NEAR	019C	_TEXT
inport_find_slave_int_loop . . .  	L NEAR	01FA	_TEXT
inport_found_irq . . . . . . . .  	L NEAR	0237	_TEXT
inport_found_slave_irq . . . . .  	L NEAR	0224	_TEXT
inport_int . . . . . . . . . . .  	F PROC	0000	_TEXT	Length = 00D2
inport_int_exit  . . . . . . . .  	L NEAR	00B3	_TEXT
inport_next_irq  . . . . . . . .  	L NEAR	01D1	_TEXT
inport_next_port . . . . . . . .  	L NEAR	00E1	_TEXT
inport_no_data . . . . . . . . .  	L NEAR	00AA	_TEXT
inport_no_irq  . . . . . . . . .  	L NEAR	01D7	_TEXT
inport_no_protect  . . . . . . .  	L NEAR	0189	_TEXT
inport_no_slave_irq  . . . . . .  	L NEAR	0223	_TEXT
inport_search  . . . . . . . . .  	N PROC	00D2	_TEXT	Global	Length = 0054
inport_search_done . . . . . . .  	L NEAR	0243	_TEXT
inport_search_next . . . . . . .  	L NEAR	00D5	_TEXT
int33_not_present  . . . . . . .  	L NEAR	0160	_TEXT
io_base  . . . . . . . . . . . .  	V WORD	0000	_DATA	External

MASK_PORT  . . . . . . . . . . .  	NUMBER	0021	
MASK_SLAVE_PORT  . . . . . . . .  	NUMBER	00A1	
MAX_INT_SIZE . . . . . . . . . .  	NUMBER	00D2	
MF_ENABLED . . . . . . . . . . .  	NUMBER	0001	
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Symbols-4


MF_INT33H  . . . . . . . . . . .  	NUMBER	0002	
MF_MOUSE_EXISTS  . . . . . . . .  	NUMBER	0080	
MF_ON_SLAVEPIC . . . . . . . . .  	NUMBER	0040	
MOUSE_SYS_VEC  . . . . . . . . .  	NUMBER	0033	
MT_BUS . . . . . . . . . . . . .  	NUMBER	0001	
MT_HP  . . . . . . . . . . . . .  	NUMBER	0005	
MT_INPORT  . . . . . . . . . . .  	NUMBER	0003	
MT_NO_MOUSE  . . . . . . . . . .  	NUMBER	0000	
MT_PS2 . . . . . . . . . . . . .  	NUMBER	0004	
MT_SERIAL  . . . . . . . . . . .  	NUMBER	0002	
mask_8259  . . . . . . . . . . .  	V BYTE	0000	_DATA	External
mouse_flags  . . . . . . . . . .  	V BYTE	0000	_DATA	External

NUMBER_BUTTONS . . . . . . . . .  	NUMBER	0002	
no_slave . . . . . . . . . . . .  	L NEAR	0095	_TEXT

OriginalCommAddrLoc  . . . . . .  	L WORD	0002	_DATA
OriginalCommPortAddr . . . . . .  	L WORD	0000	_DATA

possible_inport  . . . . . . . .  	L NEAR	00EB	_TEXT

rs232_data . . . . . . . . . . .  	L WORD	0000	BIOSDataSeg	Length = 0004

SF_ABSOLUTE  . . . . . . . . . .  	NUMBER	8000	
SF_B1_DOWN . . . . . . . . . . .  	NUMBER	0002	
SF_B1_UP . . . . . . . . . . . .  	NUMBER	0004	
SF_B2_DOWN . . . . . . . . . . .  	NUMBER	0008	
SF_B2_UP . . . . . . . . . . . .  	NUMBER	0010	
SF_MOVEMENT  . . . . . . . . . .  	NUMBER	0001	
SWAP_INT_PROC  . . . . . . . . .  	NUMBER	0014	
save_comm_port_addr  . . . . . .  	L NEAR	0277	_TEXT
show_inport_found  . . . . . . .  	L NEAR	0124	_TEXT

UPID_TEST_REG  . . . . . . . . .  	NUMBER	0003	
unhook_us  . . . . . . . . . . .  	L NEAR	0000		External

VMD_DEVICE_ID  . . . . . . . . .  	NUMBER	000C	
vector . . . . . . . . . . . . .  	V BYTE	0000	_DATA	External

WF_PMODE . . . . . . . . . . . .  	NUMBER	0001	
WinFlags . . . . . . . . . . . .  	V WORD	0000	_DATA	External
wptr . . . . . . . . . . . . . .  	TEXT  word ptr		

X_SPEED  . . . . . . . . . . . .  	NUMBER	0002	

Y_SPEED  . . . . . . . . . . . .  	NUMBER	0002	

zero_out_comm_port_addr  . . . .  	L NEAR	0274	_TEXT

?386regs . . . . . . . . . . . .  	NUMBER	0000	
@0 . . . . . . . . . . . . . . .  	L NEAR	014B	_TEXT
@1 . . . . . . . . . . . . . . .  	L NEAR	02C9	_TEXT
@Cpu . . . . . . . . . . . . . .  	TEXT  1415		
@FileName  . . . . . . . . . . .  	TEXT  inport		
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:11

Microsoft Windows InPort Mouse Dependant Code               Symbols-5


@Version . . . . . . . . . . . .  	TEXT  510		
__ROMBIOS  . . . . . . . . . . .  	NUMBER	0000		Communal


   2445 Source  Lines
   3448 Total   Lines
    378 Symbols

  46034 Bytes symbol space free

      0 Warning Errors
      0 Severe  Errors
