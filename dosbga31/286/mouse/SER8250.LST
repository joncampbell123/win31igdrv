Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-1


					page	,132
				;-----------------------------Module-Header-----------------------------;
				; Module Name:	SER8250.ASM
				;
				; Windows mouse driver data and initialization routines for using a
				; 8250 based mouse for Windows
				;
				; Created: 21-Aug-1987
				; Author:  Mr. Mouse [mickeym], Walt Moore [waltm], and a supporting
				;	   cast of thousands
				;
				; Copyright (c) 1986,1987  Microsoft Corporation
				;
				; Exported Functions:
				;	None
				; Public Functions:
				;	serial_enable
				;	serial_disable
				;	serial_search
				; Public Data:
				;	None
				; General Description:
				;	This module contains the functions to find, enable, disable,
				;	and process interrupts for an 8250 based Mouse.
				;-----------------------------------------------------------------------;
				
					title	8250 Serial Mouse Hardware Dependent Code
				
					.list
				
					??_out	ser8250
				
				
					externNP hook_us_in		;Hook us into our interrupt
					externNP unhook_us		;Hook us out of our interrupt
					externNP enable_our_int 	;Enable us at the 8259
				
				
				
				;	Definition of the bits of each 7-bit packet returned from
				;	the serial mouse.  There will be three packets per mouse
				;	event.
				
									;First packet
 = 0003				HIGH_X		equ	00000011b	;  D8:D7 of X delta (first packet)
 = 000C				HIGH_Y		equ	00001100b	;  D8:D7 of Y delta
 = 0010				B2_STAT 	equ	00010000b	;  Right button is down
 = 0020				B1_STAT 	equ	00100000b	;  Left  button is down
 = 0040				SYNC_BIT	equ	01000000b	;  Mark's first of three packets
 = 003F				LOW_X		equ	00111111b	;Second packet is X packet
 = 003F				LOW_Y		equ	00111111b	;Third	packet is Y packet (last)
				
				
 = 0003				P1_HIGH_X	equ	00000011b	;Current D8:D7 of X delta
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-2


 = 000C				P1_HIGH_Y	equ	00001100b	;Current D8:D7 of Y delta
 = 0010				P1_B2_STAT	equ	00010000b	;Current  right button status (1=down)
 = 0020				P1_B1_STAT	equ	00100000b	;Current  left	button status (1=down)
 = 0040				P1_OLD_B2_STAT	equ	01000000b	;Previous right button status (1=down)
 = 0080				P1_OLD_B1_STAT	equ	10000000b	;Previous left	button status (1=down)
				
					.errnz	P1_HIGH_X-HIGH_X	;These bits must be the same
					.errnz	P1_HIGH_Y-HIGH_Y	;  as in the first packet
					.errnz	P1_B2_STAT-B2_STAT
					.errnz	P1_B1_STAT-B1_STAT
				
				
 =-0002				NEED_PACKET_1	equ	-2		;Looking for sync   packet
 =-0001				NEED_PACKET_2	equ	-1		;Looking for second packet
 = 0000				NEED_PACKET_3	equ	0		;Looking for third  packet
				
				
 = 0060				BAUD_DIVISOR	equ	0096		;Divisor for 1200 baud
				
				
				sBegin	Data
 0000                        2	_DATA segment 
				
				externB vector				;Vector # of mouse interrupt
				externB mask_8259			;8259 interrupt enable mask
				externB mouse_flags			;Various flags as follows
				externW io_base 			;Mouse port base address
				externW enable_proc			;Address of routine to	enable mouse
				externW disable_proc			;Address of routine to disable mouse
				externB device_int			;Start of mouse specific int handler
				externW interrupt_rate			;Maximum interrupt rate of mouse
				externD event_proc			;Mouse event procedure when enabled
				
				sEnd	Data
 0000                        1	_DATA ends 
				
				
				sBegin	Code
 0000                        2	_TEXT segment 
				assumes cs,Code
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-3


				page
				
				;	This is the start of the data which will be copied into
				;	the device_int area reserved in the data segment.
				
 = 0000				SER_START	equ	this word
				
				;--------------------------Interrupt-Routine----------------------------;
				; serail_int - Mouse Interrupt Handler for an 8250 Serial Mouse
				;
				; This is the handler for the interrupt generated by the 8250 Serial
				; mouse.  It will reside in the Data segment.
				;
				; Entry:
				;	None
				; Returns:
				;	None
				; Error Returns:
				;	None
				; Registers Preserved:
				;	ALL
				; Registers Destroyed:
				;	None
				; Calls:
				;	event_proc if mouse event occured
				; History:
				;	Fri 21-Aug-1987 11:43:42 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes cs,Code
					assumes ds,nothing
					assumes es,nothing
					assumes ss,nothing
				
 = 0000				SER_PROC_START	equ	$-SER_START	;Delta to this procedure
						.errnz	SER_PROC_START	;Must be first
				
 0000				serial_int	proc	far
				
 0000  50				push	ax
 0001  53				push	bx
 0002  51				push	cx
 0003  52				push	dx
 0004  56				push	si
 0005  57				push	di
 0006  55				push	bp
 0007  1E				push	ds
 0008  06				push	es
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-4


 0009  B8 ---- R			mov	ax,_DATA
 000C  8E D8				mov	ds,ax
					assumes ds,Data
				
 000E  8B 16 0000 E			mov	dx,io_base		;Port base address
 0012  B1 02				mov	cl,2			;Shifting by two a lot
 0014  EC				in	al,dx			;Get data
 0015  D2 E0				shl	al,cl
 0017  73 12				jnc	x_or_y			;If no sync bit, may be X or Y
					.errnz	SYNC_BIT-01000000b
				
 0019  8A 26 0085 E			mov	ah,device_int[PACKET_1]
 001D  D2 E4				shl	ah,cl			;Put old button state into AH[D7:D6]
 001F  D2 C4				rol	ah,cl			;Put old button state into AH[D1:D0]
 0021  D3 E8				shr	ax,cl			;Put old button state into AL[D7:D6]
 0023  A2 0085 E			mov	device_int[PACKET_1],al
				
					.errnz	P1_B2_STAT-00010000b	;The bits must be this for the
					.errnz	P1_B1_STAT-00100000b	;  rotating to work
					.errnz	P1_OLD_B2_STAT-01000000b
					.errnz	P1_OLD_B1_STAT-10000000b
				
 0026  B8 FF00				mov	ax,NEED_PACKET_2 shl 8	;Show packet 2 needed, no event
 0029  EB 30				jmp	short set_next_packet
				
				
				;	This packet is either an X or an Y packet.  If it is an
				;	X packet, save it away and increment the packet count.
				;	If it is a Y packet, then process all the rest of the
				;	data (X delta and button deltas) and pass the event
				;	on to Windows.
				;
				;	If PACKET_COUNT indicates that we should be looking for
				;	a sync bit, then ignore this packet.
				
 002B				x_or_y:
 002B  FE 06 0086 E			inc	bptr device_int[PACKET_COUNT]
 002F  7F 09				jg	packet_is_y		;0=>1, this is last packet
 0031  A2 0084 E			mov	device_int[PACKET_2],al ;Assume we wanted to save it
 0034  B0 00				mov	al,0			;Show no event (preserve flags)
 0036  74 27				jz	serial_eoi		;This was the correct packet
 0038  EB 1F				jmp	short set_packet_1	;We were looking for sync packet
					.errnz	NEED_PACKET_1+2 	;Must be -2
					.errnz	NEED_PACKET_2+1 	;Must be -1
					.errnz	NEED_PACKET_3
				
				
				
				;	This is the last packet.  Convert all the info into what
				;	Windows needs and pass it off to it.  Both packets 2 and
				;	3 have already been shifted left 2 bits.
				
 003A				packet_is_y:
 003A  8B 16 0084 E			mov	dx,wptr device_int[PACKET_2]
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-5


					if2
					.errnz	PACKET_1-PACKET_2-1	;Want PACKET_1 in DH, PACKET_2 in DL
					endif
 003E  D3 EA				shr	dx,cl			;Compute delta X and leave it in DL
					.errnz	LOW_X-00111111b
					.errnz	P1_HIGH_X-00000011b
				
 0040  8A E6				mov	ah,dh
 0042  D3 E8				shr	ax,cl			;Compute delta Y and leave it in AL
					.errnz	LOW_Y-00111111b
					.errnz	P1_HIGH_Y-00001100b
				
 0044  32 FF				xor	bh,bh			;Get the button delta info
 0046  8A DC				mov	bl,ah
 0048  8A 9F 0087 E			mov	bl,bptr device_int[bx][STATE_XLATE]
				
 004C  98				cbw				;Sign extend Y and place it in
 004D  91				xchg	ax,cx			;  CX for Windows
 004E  92				xchg	ax,dx			;Sign extend X and place it in
 004F  98				cbw				;  BX for Windows
 0050  93				xchg	ax,bx			;Hey, the button status is now in AX!
				
 0051  8B D3				mov	dx,bx			;Set movement bit if movement
 0053  0B D1				or	dx,cx
 0055  F7 DA				neg	dx
 0057  D1 D0				rcl	ax,1
					.errnz	SF_MOVEMENT-00000001b
				
 0059				set_packet_1:
 0059  B4 FE				mov	ah,NEED_PACKET_1	;Show next packet must be sync packet
				
 005B				set_next_packet:
 005B  88 26 0086 E			mov	bptr device_int[PACKET_COUNT],ah
				
 005F				serial_eoi:
 005F  86 C4				xchg	al,ah
 0061  B0 20				mov	al,EOI
 0063  E6 20				out	ACK_PORT,al
 0065  86 C4				xchg	al,ah
 0067  98				cbw				;MSB will always be zero for us
 0068  0B C0				or	ax,ax			;Only call out if something happened
 006A  74 0C				jz	ser8250_no_data
 006C  BA 0002				mov	dx,NUMBER_BUTTONS
 006F  33 F6			        xor     si,si 			;Zero out messageextrainfo for 3.1
 0071  33 FF			        xor     di,di
 0073  FB				sti
 0074  FF 1E 0000 E			call	event_proc
				
 0078				ser8250_no_data:
 0078  07				pop	es
 0079  1F				pop	ds
 007A  5D				pop	bp
 007B  5F				pop	di
 007C  5E				pop	si
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-6


 007D  5A				pop	dx
 007E  59				pop	cx
 007F  5B				pop	bx
 0080  58				pop	ax
 0081  CF				iret
				
 0082				serial_int	endp
				
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-7


				page
				
				;	BIOS_PORT_INDEX is the location within the bios data area
				;	where the serial port address was found.  If the mouse's
				;	base port address is found in this table, the location
				;	will be zeroed when enabled, and restored when disabled.
				
 = 0082				BIOS_PORT_INDEX equ	$-SER_START	;Delta to this byte
 0082  0000					dw	0		;Assume not in table
				
				
				
				;	PACKET_2 will contain the second packet of three.  It will
				;	contain the low 6-bits of the X delta.
				
 = 0084				PACKET_2	=	$-SER_START	;Delta to this byte
 0084  00					db	0
				
				
				
				;	PACKET_1 contains the contents of the first packet of the
				;	three.	It will also contain the previous button state.
				
 = 0085				PACKET_1	equ	$-SER_START	;Delta to this byte
 0085  00					db	0
				
				;	PACKET_COUNT indicates which packet is expected next.  This
				;	allows us to do a little error checking on the packets.
				
				
 = 0086				PACKET_COUNT	=	$-SER_START	;Delta to this byte
 0086  00					db	0
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-8


				page
				
				;-----------------------------------------------------------------------;
				; state_xlate
				;
				;	state_xlate is used to translate the current and previous
				;	button state information into the values required by
				;	Windows.  It is indexed as follows:
				;
				;	    pB1 pB2 cB1 cB2
				;
				;	     |	 |   |	 |
				;	     |	 |   |	  --- 1 if button 2 is	down, 0 if button 2 is	up
				;	     |	 |   |
				;	     |	 |    ------- 1 if button 1 is	down, 0 if button 1 is	up
				;	     |	 |
				;	     |	  ----------- 1 if button 2 was down, 0 if button 2 was up
				;	     |
				;	      --------------- 1 if button 1 was down, 0 if button 1 was up
				;
				;	This table must be copied to the data segment along with the
				;	interrupt handler.
				;
				;-----------------------------------------------------------------------;
				
 = 0087				STATE_XLATE	equ	$-SER_START	;delta to this table
				
 0087  00				db	0			shr 1
 0088  04				db	(SF_B2_DOWN)		shr 1
 0089  01				db	(SF_B1_DOWN)		shr 1
 008A  05				db	(SF_B1_DOWN+SF_B2_DOWN) shr 1
				
 008B  08				db	(SF_B2_UP)		shr 1
 008C  00				db	0			shr 1
 008D  09				db	(SF_B2_UP+SF_B1_DOWN)	shr 1
 008E  01				db	(SF_B1_DOWN)		shr 1
				
 008F  02				db	(SF_B1_UP)		shr 1
 0090  06				db	(SF_B2_DOWN+SF_B1_UP)	shr 1
 0091  00				db	0			shr 1
 0092  04				db	(SF_B2_DOWN)		shr 1
				
 0093  0A				db	(SF_B1_UP+SF_B2_UP)	shr 1
 0094  02				db	(SF_B1_UP)		shr 1
 0095  08				db	(SF_B2_UP)		shr 1
 0096  00				db	0			shr 1
				
					.errnz	NUMBER_BUTTONS-2	;Won't work unless a two button mouse
				
				
 = 0097				SER_INT_LENGTH	= $-SER_START		;Length of code to copy
					.errnz	SER_INT_LENGTH gt MAX_INT_SIZE
				
				display_int_size  %SER_INT_LENGTH
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-9


				page
				
				;---------------------------Private-Routine-----------------------------;
				; serial_enable - Enable Serial Mouse
				;
				; The Serial mouse will be initialized, the interrupt vector hooked,
				; the old interrupt mask saved, and our interrupt enabled at the 8259.
				;
				; Entry:
				;	None
				; Returns:
				;	None
				; Error Returns:
				;	None
				; Registers Preserved:
				;	BP,DS
				; Registers Destroyed:
				;	AX,BX,CX,DX,SI,DI,ES,FLAGS
				; Calls:
				;	hook_us_in
				;	enable_our_int
				;	test_card
				; History:
				;	Fri 21-Aug-1987 11:43:42 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes ds,Data
					assumes es,nothing
					assumes ss,nothing
				
						public	serial_enable	;Public for debugging
 0097				serial_enable	proc	near
				
 0097  E8 0000 E			call	hook_us_in		;Hook us into the interrupt
				
				;	It is possible that somebody unplugged the serial mouse
				;	since we were last here.  Tough.  We'll ignore the error
				;	for now.
				
 009A  8B 3E 0000 E			mov	di,io_base		;Initialize the serial mouse
 009E  E8 017C R			call	test_card
				
				
				;	See if BIOS knows about this card.  If so, delete if from
				;	the BIOS table so other applications will not try and use it.
				
 00A1  B8 ---- R			mov	ax,BIOSDataSeg
 00A4  8E C0				mov	es,ax
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-10


					assumes es,BIOSDataSeg
 00A6  33 C0				xor	ax,ax
				
 00A8  C7 06 0082 E FFFF		mov	wptr device_int[BIOS_PORT_INDEX],-1;port address not zeroed
 00AE  BB 0000 R			mov	bx,offset rs232_data	;Start of serial ports
 00B1  26: 39 3F			cmp	es:[bx],di
 00B4  74 07				je	zero_bios_port		;Match
 00B6  43				inc	bx
 00B7  43				inc	bx
 00B8  26: 39 3F			cmp	es:[bx],di
 00BB  75 07				jne	save_bios_addr		;No match
				
 00BD				zero_bios_port:
 00BD  26: 89 07			mov	es:[bx],ax		;Zero the port address
 00C0  93				xchg	ax,bx			;Set AX = address of match
 00C1  A3 0082 E			mov	wptr device_int[BIOS_PORT_INDEX],ax
				
 00C4				save_bios_addr:
 00C4  C6 06 0086 E FE			mov	bptr device_int[PACKET_COUNT],NEED_PACKET_1
				
 00C9  E8 0000 E			call	enable_our_int		;Enable 8259 interrupts
				
 00CC  8D 55 01				lea	dx,[di].ACE_IER 	;Enable interrupts at the 8250
 00CF  B0 01				mov	al,ACE_ERBFI
 00D1  EE				out	dx,al
				
 00D2  8D 55 04				lea	dx,[di].ACE_MCR 	;Also have to raise ACE_OUT2
					io_delay			;  to get interrupts off the board
 00D5  EB 00                 1		jmp	short $+2 
 00D7  EB 00                 1		jmp	short $+2 
 00D9  EB 00                 1		jmp	short $+2 
 00DB  EC				in	al,dx
 00DC  0C 08				or	al,ACE_OUT2
					io_delay
 00DE  EB 00                 1		jmp	short $+2 
 00E0  EB 00                 1		jmp	short $+2 
 00E2  EB 00                 1		jmp	short $+2 
 00E4  EE				out	dx,al
				
 00E5  C3				ret
				
 00E6				serial_enable	endp
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-11


				page
				
				;---------------------------Private-Routine-----------------------------;
				; serial_disable - Disable Serial Mouse
				;
				; The interrupt vector will be restored, the old interrupt mask
				; restored at the 8259.  If the old mask shows that the mouse was
				; previously enabled, it will remain enabled, else we will disable
				; interrupts at the mouse itself.
				;
				; Entry:
				;	None
				; Returns:
				;	None
				; Error Returns:
				;	None
				; Registers Preserved:
				;	DS,BP
				; Registers Destroyed:
				;	AX,BX,CX,DX,SI,DI,ES,FLAGS
				; Calls:
				;	unhook_us
				; History:
				;	Fri 21-Aug-1987 11:43:42 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes ds,Data
					assumes es,nothing
					assumes ss,nothing
				
						public	serial_disable	;Public for debugging
 00E6				serial_disable	proc	near
				
 00E6  8B 3E 0000 E			mov	di,io_base
 00EA  8D 55 01				lea	dx,[di].ACE_IER 	;Disable interrupts at the 8250
 00ED  32 C0				xor	al,al
 00EF  EE				out	dx,al
 00F0  8D 55 04				lea	dx,[di].ACE_MCR 	;Tri-state the serial board IRQ
					io_delay			;  by dropping ACE_OUT2
 00F3  EB 00                 1		jmp	short $+2 
 00F5  EB 00                 1		jmp	short $+2 
 00F7  EB 00                 1		jmp	short $+2 
 00F9  EC				in	al,dx
 00FA  24 F7				and	al,not ACE_OUT2
					io_delay
 00FC  EB 00                 1		jmp	short $+2 
 00FE  EB 00                 1		jmp	short $+2 
 0100  EB 00                 1		jmp	short $+2 
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-12


 0102  EE				out	dx,al
				
 0103  E8 0000 E			call	unhook_us		;Restore everything to what it was
 0106  75 1D				jnz	serial_restore_bios_data;IRQ was previously disabled
				
 0108  8B 3E 0000 E			mov	di,io_base
 010C  8D 55 01				lea	dx,[di].ACE_IER 	;Disable interrupts at the 8250
 010F  B0 01				mov	al,ACE_ERBFI
 0111  EE				out	dx,al
 0112  8D 55 04				lea	dx,[di].ACE_MCR 	;Also have to raise ACE_OUT2
					io_delay			;  to get interrupts off the board
 0115  EB 00                 1		jmp	short $+2 
 0117  EB 00                 1		jmp	short $+2 
 0119  EB 00                 1		jmp	short $+2 
 011B  EC				in	al,dx
 011C  0C 08				or	al,ACE_OUT2
					io_delay
 011E  EB 00                 1		jmp	short $+2 
 0120  EB 00                 1		jmp	short $+2 
 0122  EB 00                 1		jmp	short $+2 
 0124  EE				out	dx,al
				
 0125				serial_restore_bios_data:
				
				;	See if BIOS knew about this card.  If so, restore the BIOS
				;	table so other applications may use the port.
				
 0125  8B 0E 0082 E			mov	cx,wptr device_int[BIOS_PORT_INDEX]
 0129  41				inc	cx			;-1 = port address not zeroed out
 012A  E3 0B				jcxz	done_with_serial_disable
 012C  49				dec	cx			;cx has offset in 40:
 012D  B8 ---- R			mov	ax,BIOSDataSeg
 0130  8E C0				mov	es,ax
					assumes es,BIOSDataSeg
 0132  87 D9				xchg	bx,cx
 0134  26: 89 3F			mov	es:[bx],di		;Restore port address
				
 0137				done_with_serial_disable:
 0137  C3				ret
				
 0138				serial_disable	endp
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-13


				page
				
				;-----------------------------------------------------------------------;
				;	ser_parms is the table of serial ports to search fro when
				;	looking for a mouse.  An installed mouse driver may have
				;	already zeroed the port address in the ROM BIOS data area,
				;	so we use this table.
				;-----------------------------------------------------------------------;
				
 0138				ser_parms	label	word
									;Serial port 2 (COM2)
 0138  02F8				dw	2F8h			;  io_base
 013A  0B				db	0Bh			;  Interrupt vector number
 013B  F7				db	11110111b		;  Interrupt request mask (IRQ 3)
									;Serial port 1 (COM1)
 013C  03F8				dw	3F8h			;  io_base
 013E  0C				db	0Ch			;  Interrupt vector number
 013F  EF				db	11101111b		;  Interrupt request mask (IRQ 4)
				
 0140  0000				dw	0			;End of table
				
				
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-14


				page
				
				;---------------------------Public-Routine------------------------------;
				; serial_search - Search for a Serial Mouse
				;
				; A search will be made for a serial mouse.
				;
				; Entry:
				;	None
				; Returns:
				;	'C' set if found
				;	  AX = address of interrupt routine if interrupt vector found
				;	  SI = offset within the Code segment of the handler
				; Error Returns:
				;	'C' clear if not found
				; Registers Preserved:
				;	DS,BP
				; Registers Destroyed:
				;	AX,BX,DX,ES,FLAGS
				; Calls:
				;	test_card
				; History:
				;	Mon 24-Aug-1987 23:54:02 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes cs,Code
					assumes ds,Data
				
						public	serial_search
 0142				serial_search	proc	near
				
 0142  BE 0138 R			mov	si,CodeOFFSET ser_parms ;Table of possible serial cards
				
 0145				next_serial_port:
 0145  2E: AD				lods	wptr cs:[si]		;Get next port address
 0147  0B C0				or	ax,ax			;If 0, then end of ports
 0149  74 2B				jz	no_serial_mouse 	;Return 'C' clear to show not found
 014B  A3 0000 E			mov	io_base,ax
 014E  2E: AD				lods	wptr cs:[si]
 0150  A2 0000 E			mov	vector,al
 0153  88 26 0000 E			mov	mask_8259,ah
 0157  E8 017C R			call	test_card		;See if card is the mouse
 015A  72 E9				jc	next_serial_port	;Not the mouse, try next card
				
 015C  C7 06 0000 E 0028		mov	interrupt_rate,40
 0162  C7 06 0000 E 0097 R		mov	enable_proc,CodeOFFSET serial_enable
 0168  C7 06 0000 E 00E6 R		mov	disable_proc,CodeOFFSET serial_disable
 016E  BE 0000 R			mov	si,CodeOFFSET serial_int
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-15


 0171  B9 0097				mov	cx,SER_INT_LENGTH
 0174  F9				stc				;'C' to show found
 0175  C3				ret
				
 0176				no_serial_mouse:
 0176  C6 06 0000 E FF			mov	vector,-1		;We trashed this and must restore it
 017B  C3				ret				;'C' clear
				
 017C				serial_search	endp
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-16


				page
				
				;---------------------------Private-Routine-----------------------------;
				; test_card - Test Serial Card For A Mouse
				;
				; The serial port will be programmed correctly for the mouse, and
				; a test made to see if one is really attached.  If found, then the
				; port is correctly programmed for the mouse.  If not found, the
				; port will be restored.
				;
				; Interrupts for the port will be disabled at the 8259 prior to the
				; search, and restored to their initial state afterwards.
				;
				; Entry:
				;	None
				; Returns:
				;	'C' set if found
				;	'C' clear if not found
				; Error Returns:
				;	None
				; Registers Preserved:
				;	SI,DS,BP
				; Registers Destroyed:
				;	AX,BX,CX,DX,DI,ES,FLAGS
				; Calls:
				;	test_loop
				; History:
				;	Mon 24-Aug-1987 23:54:02 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes cs,Code
					assumes ds,Data
				
						public	test_card	;Public for debugging
 017C				test_card	proc	near
				
				;	While futzing with the 8250, we'll disable interrupts
				;	at the 8259.
				
 017C  8A 26 0000 E			mov	ah,mask_8259		;Get our 8259 enable mask
 0180  F6 D4				not	ah			;A 1 bit for our IRQ
 0182  FA				cli
 0183  E4 21				in	al,MASK_PORT		;Get current 8259 mask
 0185  8A D8				mov	bl,al
 0187  0A C4				or	al,ah
 0189  E6 21				out	MASK_PORT,al		;Disable mouse int
 018B  FB				sti
				
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-17


 018C  22 DC				and	bl,ah			;Isolate old IRQ bit, keep in BL
				
 018E  8B 3E 0000 E			mov	di,io_base		;Keep base address in DI
 0192  8D 55 03				lea	dx,[di].ACE_LCR 	;Save line control on stack
 0195  EC				in	al,dx
 0196  50				push	ax
				
 0197  B0 80				mov	al,ACE_DLAB		;Access divisor latches
					io_delay
 0199  EB 00                 1		jmp	short $+2 
 019B  EB 00                 1		jmp	short $+2 
 019D  EB 00                 1		jmp	short $+2 
 019F  EE				out	dx,al
				
 01A0  8D 55 01				lea	dx,[di].ACE_DLM 	;Save MSB divisor
					io_delay
 01A3  EB 00                 1		jmp	short $+2 
 01A5  EB 00                 1		jmp	short $+2 
 01A7  EB 00                 1		jmp	short $+2 
 01A9  EC				in	al,dx
 01AA  50				push	ax
				
 01AB  B0 00				mov	al,high BAUD_DIVISOR	;Set MSB of our divisor
					io_delay
 01AD  EB 00                 1		jmp	short $+2 
 01AF  EB 00                 1		jmp	short $+2 
 01B1  EB 00                 1		jmp	short $+2 
 01B3  EE				out	dx,al
				
 01B4  8D 15				lea	dx,[di].ACE_DLL 	;Save LSB divisor
					io_delay
 01B6  EB 00                 1		jmp	short $+2 
 01B8  EB 00                 1		jmp	short $+2 
 01BA  EB 00                 1		jmp	short $+2 
 01BC  EC				in	al,dx
 01BD  50				push	ax
				
 01BE  B0 60				mov	al,low BAUD_DIVISOR	;Set LSB of our divisor
					io_delay
 01C0  EB 00                 1		jmp	short $+2 
 01C2  EB 00                 1		jmp	short $+2 
 01C4  EB 00                 1		jmp	short $+2 
 01C6  EE				out	dx,al
				
 01C7  8D 55 03				lea	dx,[di].ACE_LCR 	;Line control port
 01CA  B0 02				mov	al,ACE_7BW+ACE_1SB
					io_delay
 01CC  EB 00                 1		jmp	short $+2 
 01CE  EB 00                 1		jmp	short $+2 
 01D0  EB 00                 1		jmp	short $+2 
 01D2  EE				out	dx,al
				
 01D3  8D 55 01				lea	dx,[di].ACE_IER 	;Interrupt enable port
					io_delay
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-18


 01D6  EB 00                 1		jmp	short $+2 
 01D8  EB 00                 1		jmp	short $+2 
 01DA  EB 00                 1		jmp	short $+2 
 01DC  EC				in	al,dx			;--> interrupt enable
 01DD  50				push	ax			;Save interrupt enable on stack
				
 01DE  32 C0				xor	al,al			;Disable 8250 interrupts
					io_delay
 01E0  EB 00                 1		jmp	short $+2 
 01E2  EB 00                 1		jmp	short $+2 
 01E4  EB 00                 1		jmp	short $+2 
 01E6  EE				out	dx,al
				
 01E7  8D 55 05				lea	dx,[di].ACE_LSR 	;Clear error flags
					io_delay
 01EA  EB 00                 1		jmp	short $+2 
 01EC  EB 00                 1		jmp	short $+2 
 01EE  EB 00                 1		jmp	short $+2 
 01F0  EC				in	al,dx
				
 01F1  8D 55 04				lea	dx,[di].ACE_MCR 	;Save modem control on stack
					io_delay
 01F4  EB 00                 1		jmp	short $+2 
 01F6  EB 00                 1		jmp	short $+2 
 01F8  EB 00                 1		jmp	short $+2 
 01FA  EC				in	al,dx
 01FB  50				push	ax
				
 01FC  B5 03				mov	ch,3			;--> fast reset value
 01FE  E8 0248 R			call	test_loop		;Try fast reset
 0201  73 2F				jnc	got_card		;Found a fast serial port
 0203  B5 09				mov	ch,9			;--> slow reset value
 0205  E8 0248 R			call	test_loop		;Try slow reset
 0208  73 28				jnc	got_card		;Found a slow serial port
				
 020A  8D 55 04				lea	dx,[di].ACE_MCR 	;Restore modem control
 020D  58				pop	ax
 020E  EE				out	dx,al
				
 020F  8D 55 01				lea	dx,[di].ACE_IER 	;Restore interrupt enable
 0212  58				pop	ax
 0213  EE				out	dx,al
				
 0214  8D 55 03				lea	dx,[di].ACE_LCR 	;Enable divisor access
 0217  B0 80				mov	al,ACE_DLAB
					io_delay
 0219  EB 00                 1		jmp	short $+2 
 021B  EB 00                 1		jmp	short $+2 
 021D  EB 00                 1		jmp	short $+2 
 021F  EE				out	dx,al
				
 0220  8D 15				lea	dx,[di].ACE_DLL 	;Restore lsb of divisor
 0222  58				pop	ax
 0223  EE				out	dx,al
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-19


				
 0224  8D 55 01				lea	dx,[di].ACE_DLM 	;Restore msb of divisor
 0227  58				pop	ax
 0228  EE				out	dx,al
				
 0229  8D 55 03				lea	dx,[di].ACE_LCR
 022C  58				pop	ax			;Restore line control
 022D  EE				out	dx,al
 022E  B7 80				mov	bh,80h			;Show not found
 0230  EB 05				jmp	short restore_8259
				
 0232				got_card:
 0232  83 C4 0A				add	sp,5*2			;Clear all the saved parameters
 0235  32 FF				xor	bh,bh			;Show found
				
 0237				restore_8259:
 0237  8A 26 0000 E			mov	ah,mask_8259		;Get our enable mask
 023B  FA				cli
 023C  E4 21				in	al,MASK_PORT		;Get current 8259 mask
 023E  22 C4				and	al,ah			;Remove our IRQ bit
 0240  0A C3				or	al,bl			;Restore old IRQ bit
 0242  E6 21				out	MASK_PORT,al
 0244  FB				sti
				
 0245  D0 E7				shl	bh,1			;Set/clear carry as appropriate
 0247  C3				ret
				
 0248				test_card	endp
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-20


				page
				
				;---------------------------Private-Routine-----------------------------;
				; test_loop - Test Serial Card For A Mouse
				;
				; Test loop cycles the power to the serial mouse, delays while
				; waiting for it to power up, then waits for the mouse to return
				; an 'M'.  If an 'M' is returned withing the alloted time, a mouse
				; has been found.  IF not, no mouse has been found.
				;
				; Entry:
				;	DI = port base address
				;	CH = # timer ticks to delay while flushing
				; Returns:
				;	'C' clear if found
				;	'C' set   if not found
				; Error Returns:
				;	None
				; Registers Preserved:
				;	BX,SI,DS,BP
				; Registers Destroyed:
				;	AX,CX,DX,DI,ES,FLAGS
				; Calls:
				;	None
				; History:
				;	Wed 02-Sep-1987 14:43:29 -by-  Walt Moore [waltm]
				;	Load new timer before entering flush_loop_2
				;
				;	Mon 24-Aug-1987 23:54:02 -by-  Walt Moore [waltm] & Mr. Mouse
				;	Initial version
				;-----------------------------------------------------------------------;
				
				;------------------------------Pseudo-Code------------------------------;
				; {
				; }
				;-----------------------------------------------------------------------;
				
					assumes cs,Code
					assumes ds,Data
				
						public	test_loop	;Public for debugging
 0248				test_loop	proc	near
				
 0248  8D 55 04				lea	dx,[di].ACE_MCR 	;Set DTR & reset RTS
 024B  B0 01				mov	al,ACE_DTR
 024D  EE				out	dx,al
				
 024E  B8 ---- R			mov	ax,BIOSDataSeg
 0251  8E C0				mov	es,ax
					assumes es,BIOSDataSeg
				
 0253  26: 8A 0E 006C R			mov	cl,bios_time		;Flush 8250 receive buffer
 0258  8D 15				lea	dx,[di].ACE_RBR
 025A  EC				in	al,dx			;Flush a character
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-21


				
 025B				flush_loop_1:
 025B  26: 3A 0E 006C R			cmp	cl,bios_time		;Wait 0-55 milliseconds
 0260  74 F9				je	flush_loop_1
 0262  8A E5				mov	ah,ch			;Count this many timer ticks
 0264  FE C4				inc	ah			;First cmp will fail, so adjust for it
					io_delay
 0266  EB 00                 1		jmp	short $+2 
 0268  EB 00                 1		jmp	short $+2 
 026A  EB 00                 1		jmp	short $+2 
 026C  EC				in	al,dx			;Flush a character
				
 026D				flush_loop_2:
 026D  26: 3A 0E 006C R			cmp	cl,bios_time		;Wait 55 or 330 milliseconds
 0272  74 F9				je	flush_loop_2
 0274  26: 8A 0E 006C R			mov	cl,bios_time
 0279  FE CC				dec	ah
 027B  75 F0				jnz	flush_loop_2
 027D  EC				in	al,dx			;Flush a character
				
 027E				flush_loop_3:
 027E  26: 3A 0E 006C R			cmp	cl,bios_time		;Wait 55 milliseconds
 0283  74 F9				je	flush_loop_3
 0285  8D 55 05				lea	dx,[di].ACE_LSR 	;Clear error flags
 0288  EC				in	al,dx
				
 0289  8D 55 04				lea	dx,[di].ACE_MCR 	;Power up the mouse
 028C  B0 03				mov	al,ACE_DTR+ACE_RTS
					io_delay
 028E  EB 00                 1		jmp	short $+2 
 0290  EB 00                 1		jmp	short $+2 
 0292  EB 00                 1		jmp	short $+2 
 0294  EE				out	dx,al
				
				
				;	Read 3 characters looking for capital M sent by mouse
				
 0295  B5 04				mov	ch,3+1			;Try first three characters
				
 0297				not_M:					;Character read wasn't an M
 0297  FE CD				dec	ch			;Decrement remaining tries counter
 0299  74 33				jz	no_M_found		;Out of attempts
				
 029B				read_loop:
 029B  8D 55 05				lea	dx,[di].ACE_LSR 	;--> status port
 029E  B4 4D				mov	ah,'M'			;Capacitance will keep 'M" floating
 02A0  26: 8A 0E 006C R			mov	cl,bios_time		;  on data bus if a CMP AL,'M' is used
				
 02A5				read_loop_1:
					io_delay
 02A5  EB 00                 1		jmp	short $+2 
 02A7  EB 00                 1		jmp	short $+2 
 02A9  EB 00                 1		jmp	short $+2 
 02AB  EC				in	al,dx			;--> status
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Page     1-22


 02AC  A8 01				test	al,ACE_DR		;Check if character available
 02AE  75 20				jnz	got_char		;Character available
 02B0  26: 3A 0E 006C R			cmp	cl,bios_time		;Check for 0-55 milliseconds
 02B5  74 EE				je	read_loop_1
 02B7  26: 8A 0E 006C R			mov	cl,bios_time
				
 02BC				read_loop_2:
					io_delay
 02BC  EB 00                 1		jmp	short $+2 
 02BE  EB 00                 1		jmp	short $+2 
 02C0  EB 00                 1		jmp	short $+2 
 02C2  EC				in	al,dx			;--> status
 02C3  A8 01				test	al,ACE_DR		;Check if character available
 02C5  75 09				jnz	got_char		;Character available
 02C7  26: 3A 0E 006C R			cmp	cl,bios_time		;Check for 0-55 milliseconds
 02CC  74 EE				je	read_loop_2
				
 02CE				no_M_found:
 02CE  F9				stc				;No mouse
 02CF  C3				ret
				
 02D0				got_char:
 02D0  8D 15				lea	dx,[di].ACE_RBR 	;Have a character.  It must be
					io_delay			;  an M if it's our mouse
 02D2  EB 00                 1		jmp	short $+2 
 02D4  EB 00                 1		jmp	short $+2 
 02D6  EB 00                 1		jmp	short $+2 
 02D8  EC				in	al,dx
 02D9  3A C4				cmp	al,ah
 02DB  75 BA				jne	not_M			;Not an "M"
				;	clc				;Got it!!!!
 02DD  C3				ret
				
 02DE				test_loop	endp
				
				sEnd	Code
 02DE                        1	_TEXT ends 
				end

Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Symbols-1


Macros:

		N a m e			Lines

display_int_size . . . . . . . .  	   3
io_delay . . . . . . . . . . . .  	   3

Segments and Groups:

                N a m e         	Length	 Align	Combine Class

BIOSDataSeg  . . . . . . . . . .  	006D	AT	0040	
DGROUP . . . . . . . . . . . . .  	GROUP
  _DATA  . . . . . . . . . . . .  	0000	WORD	PUBLIC	'DATA'
_TEXT  . . . . . . . . . . . . .  	02DE	WORD	PUBLIC	'CODE'

Symbols:            

                N a m e         	Type	 Value	 Attr

ACE_1SB  . . . . . . . . . . . .  	NUMBER	0000	
ACE_2SB  . . . . . . . . . . . .  	NUMBER	0004	
ACE_5BW  . . . . . . . . . . . .  	NUMBER	0000	
ACE_6BW  . . . . . . . . . . . .  	NUMBER	0001	
ACE_7BW  . . . . . . . . . . . .  	NUMBER	0002	
ACE_8BW  . . . . . . . . . . . .  	NUMBER	0003	
ACE_BI . . . . . . . . . . . . .  	NUMBER	0010	
ACE_CTS  . . . . . . . . . . . .  	NUMBER	0010	
ACE_DCTS . . . . . . . . . . . .  	NUMBER	0001	
ACE_DDSR . . . . . . . . . . . .  	NUMBER	0002	
ACE_DLAB . . . . . . . . . . . .  	NUMBER	0080	
ACE_DLL  . . . . . . . . . . . .  	NUMBER	0000	
ACE_DLM  . . . . . . . . . . . .  	NUMBER	0001	
ACE_DR . . . . . . . . . . . . .  	NUMBER	0001	
ACE_DRLSD  . . . . . . . . . . .  	NUMBER	0008	
ACE_DSR  . . . . . . . . . . . .  	NUMBER	0020	
ACE_DTR  . . . . . . . . . . . .  	NUMBER	0001	
ACE_EDSSI  . . . . . . . . . . .  	NUMBER	0008	
ACE_ELSI . . . . . . . . . . . .  	NUMBER	0004	
ACE_EPS  . . . . . . . . . . . .  	NUMBER	0010	
ACE_ERBFI  . . . . . . . . . . .  	NUMBER	0001	
ACE_ETBEI  . . . . . . . . . . .  	NUMBER	0002	
ACE_FE . . . . . . . . . . . . .  	NUMBER	0008	
ACE_IER  . . . . . . . . . . . .  	NUMBER	0001	
ACE_IID  . . . . . . . . . . . .  	NUMBER	0006	
ACE_IIDR . . . . . . . . . . . .  	NUMBER	0002	
ACE_IIP  . . . . . . . . . . . .  	NUMBER	0001	
ACE_LCR  . . . . . . . . . . . .  	NUMBER	0003	
ACE_LOOP . . . . . . . . . . . .  	NUMBER	0010	
ACE_LSR  . . . . . . . . . . . .  	NUMBER	0005	
ACE_MCR  . . . . . . . . . . . .  	NUMBER	0004	
ACE_MSI  . . . . . . . . . . . .  	NUMBER	0000	
ACE_MSR  . . . . . . . . . . . .  	NUMBER	0006	
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Symbols-2


ACE_OR . . . . . . . . . . . . .  	NUMBER	0002	
ACE_OUT1 . . . . . . . . . . . .  	NUMBER	0004	
ACE_OUT2 . . . . . . . . . . . .  	NUMBER	0008	
ACE_PE . . . . . . . . . . . . .  	NUMBER	0004	
ACE_PEN  . . . . . . . . . . . .  	NUMBER	0008	
ACE_PSB  . . . . . . . . . . . .  	NUMBER	0030	
ACE_RBR  . . . . . . . . . . . .  	NUMBER	0000	
ACE_RDAI . . . . . . . . . . . .  	NUMBER	0004	
ACE_RI . . . . . . . . . . . . .  	NUMBER	0040	
ACE_RLSD . . . . . . . . . . . .  	NUMBER	0080	
ACE_RLSI . . . . . . . . . . . .  	NUMBER	0006	
ACE_RTS  . . . . . . . . . . . .  	NUMBER	0002	
ACE_SB . . . . . . . . . . . . .  	NUMBER	0040	
ACE_SP . . . . . . . . . . . . .  	NUMBER	0020	
ACE_STB  . . . . . . . . . . . .  	NUMBER	0004	
ACE_TERI . . . . . . . . . . . .  	NUMBER	0004	
ACE_THR  . . . . . . . . . . . .  	NUMBER	0000	
ACE_THRE . . . . . . . . . . . .  	NUMBER	0020	
ACE_THREI  . . . . . . . . . . .  	NUMBER	0002	
ACE_TSRE . . . . . . . . . . . .  	NUMBER	0040	
ACE_WLS  . . . . . . . . . . . .  	NUMBER	0003	
ACE_WLS0 . . . . . . . . . . . .  	NUMBER	0001	
ACE_WLS1 . . . . . . . . . . . .  	NUMBER	0002	
ACK_PORT . . . . . . . . . . . .  	NUMBER	0020	
ACK_SLAVE_PORT . . . . . . . . .  	NUMBER	00A0	

B1_STAT  . . . . . . . . . . . .  	NUMBER	0020	
B2_STAT  . . . . . . . . . . . .  	NUMBER	0010	
BASH_INT_PROC  . . . . . . . . .  	NUMBER	000C	
BAUD_DIVISOR . . . . . . . . . .  	NUMBER	0060	
BIOS_PORT_INDEX  . . . . . . . .  	NUMBER	0082	
bios_time  . . . . . . . . . . .  	L BYTE	006C	BIOSDataSeg
bptr . . . . . . . . . . . . . .  	TEXT  byte ptr		

CALL_ON_ANY_INT  . . . . . . . .  	NUMBER	001F	
CLEAR_COUNTERS . . . . . . . . .  	NUMBER	000B	
CodeBASE . . . . . . . . . . . .  	ALIAS	 _TEXT		
CodeOFFSET . . . . . . . . . . .  	TEXT  offset _TEXT:		

DataBASE . . . . . . . . . . . .  	ALIAS	 DGROUP		
DataOFFSET . . . . . . . . . . .  	TEXT  offset DGROUP:		
device_int . . . . . . . . . . .  	V BYTE	0000	_DATA	External
disable_proc . . . . . . . . . .  	V WORD	0000	_DATA	External
done_with_serial_disable . . . .  	L NEAR	0137	_TEXT
dptr . . . . . . . . . . . . . .  	TEXT  dword ptr		

EOI  . . . . . . . . . . . . . .  	NUMBER	0020	
enable_our_int . . . . . . . . .  	L NEAR	0000		External
enable_proc  . . . . . . . . . .  	V WORD	0000	_DATA	External
event_proc . . . . . . . . . . .  	V DWORD	0000	_DATA	External

flush_loop_1 . . . . . . . . . .  	L NEAR	025B	_TEXT
flush_loop_2 . . . . . . . . . .  	L NEAR	026D	_TEXT
flush_loop_3 . . . . . . . . . .  	L NEAR	027E	_TEXT
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Symbols-3



got_card . . . . . . . . . . . .  	L NEAR	0232	_TEXT
got_char . . . . . . . . . . . .  	L NEAR	02D0	_TEXT

HIGH_X . . . . . . . . . . . . .  	NUMBER	0003	
HIGH_Y . . . . . . . . . . . . .  	NUMBER	000C	
hook_us_in . . . . . . . . . . .  	L NEAR	0000		External

INT33H_BUS . . . . . . . . . . .  	NUMBER	0001	
INT33H_ENABLE  . . . . . . . . .  	NUMBER	0020	
INT33H_GETINFO . . . . . . . . .  	NUMBER	0024	
INT33H_HP  . . . . . . . . . . .  	NUMBER	0005	
INT33H_INPORT  . . . . . . . . .  	NUMBER	0003	
INT33H_PS_2  . . . . . . . . . .  	NUMBER	0004	
INT33H_RESET . . . . . . . . . .  	NUMBER	0000	
INT33H_SERIAL  . . . . . . . . .  	NUMBER	0002	
INT_REQUEST  . . . . . . . . . .  	NUMBER	000A	
IN_SERVICE . . . . . . . . . . .  	NUMBER	000B	
interrupt_rate . . . . . . . . .  	V WORD	0000	_DATA	External
io_base  . . . . . . . . . . . .  	V WORD	0000	_DATA	External

LOW_X  . . . . . . . . . . . . .  	NUMBER	003F	
LOW_Y  . . . . . . . . . . . . .  	NUMBER	003F	

MASK_PORT  . . . . . . . . . . .  	NUMBER	0021	
MASK_SLAVE_PORT  . . . . . . . .  	NUMBER	00A1	
MAX_INT_SIZE . . . . . . . . . .  	NUMBER	00D2	
MF_ENABLED . . . . . . . . . . .  	NUMBER	0001	
MF_INT33H  . . . . . . . . . . .  	NUMBER	0002	
MF_MOUSE_EXISTS  . . . . . . . .  	NUMBER	0080	
MF_ON_SLAVEPIC . . . . . . . . .  	NUMBER	0040	
MOUSE_SYS_VEC  . . . . . . . . .  	NUMBER	0033	
MT_BUS . . . . . . . . . . . . .  	NUMBER	0001	
MT_HP  . . . . . . . . . . . . .  	NUMBER	0005	
MT_INPORT  . . . . . . . . . . .  	NUMBER	0003	
MT_NO_MOUSE  . . . . . . . . . .  	NUMBER	0000	
MT_PS2 . . . . . . . . . . . . .  	NUMBER	0004	
MT_SERIAL  . . . . . . . . . . .  	NUMBER	0002	
mask_8259  . . . . . . . . . . .  	V BYTE	0000	_DATA	External
mouse_flags  . . . . . . . . . .  	V BYTE	0000	_DATA	External

NEED_PACKET_1  . . . . . . . . .  	NUMBER	-0002	
NEED_PACKET_2  . . . . . . . . .  	NUMBER	-0001	
NEED_PACKET_3  . . . . . . . . .  	NUMBER	0000	
NUMBER_BUTTONS . . . . . . . . .  	NUMBER	0002	
next_serial_port . . . . . . . .  	L NEAR	0145	_TEXT
no_M_found . . . . . . . . . . .  	L NEAR	02CE	_TEXT
no_serial_mouse  . . . . . . . .  	L NEAR	0176	_TEXT
not_M  . . . . . . . . . . . . .  	L NEAR	0297	_TEXT

P1_B1_STAT . . . . . . . . . . .  	NUMBER	0020	
P1_B2_STAT . . . . . . . . . . .  	NUMBER	0010	
P1_HIGH_X  . . . . . . . . . . .  	NUMBER	0003	
P1_HIGH_Y  . . . . . . . . . . .  	NUMBER	000C	
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Symbols-4


P1_OLD_B1_STAT . . . . . . . . .  	NUMBER	0080	
P1_OLD_B2_STAT . . . . . . . . .  	NUMBER	0040	
PACKET_1 . . . . . . . . . . . .  	NUMBER	0085	
PACKET_2 . . . . . . . . . . . .  	NUMBER	0084	
PACKET_COUNT . . . . . . . . . .  	NUMBER	0086	
packet_is_y  . . . . . . . . . .  	L NEAR	003A	_TEXT

read_loop  . . . . . . . . . . .  	L NEAR	029B	_TEXT
read_loop_1  . . . . . . . . . .  	L NEAR	02A5	_TEXT
read_loop_2  . . . . . . . . . .  	L NEAR	02BC	_TEXT
restore_8259 . . . . . . . . . .  	L NEAR	0237	_TEXT
rs232_data . . . . . . . . . . .  	L WORD	0000	BIOSDataSeg	Length = 0004

SER_INT_LENGTH . . . . . . . . .  	NUMBER	0097	
SER_PROC_START . . . . . . . . .  	NUMBER	0000	
SER_START  . . . . . . . . . . .  	WORD	0000	_TEXT
SF_ABSOLUTE  . . . . . . . . . .  	NUMBER	8000	
SF_B1_DOWN . . . . . . . . . . .  	NUMBER	0002	
SF_B1_UP . . . . . . . . . . . .  	NUMBER	0004	
SF_B2_DOWN . . . . . . . . . . .  	NUMBER	0008	
SF_B2_UP . . . . . . . . . . . .  	NUMBER	0010	
SF_MOVEMENT  . . . . . . . . . .  	NUMBER	0001	
STATE_XLATE  . . . . . . . . . .  	NUMBER	0087	
SWAP_INT_PROC  . . . . . . . . .  	NUMBER	0014	
SYNC_BIT . . . . . . . . . . . .  	NUMBER	0040	
save_bios_addr . . . . . . . . .  	L NEAR	00C4	_TEXT
ser8250_no_data  . . . . . . . .  	L NEAR	0078	_TEXT
ser_parms  . . . . . . . . . . .  	L WORD	0138	_TEXT
serial_disable . . . . . . . . .  	N PROC	00E6	_TEXT	Global	Length = 0052
serial_enable  . . . . . . . . .  	N PROC	0097	_TEXT	Global	Length = 004F
serial_eoi . . . . . . . . . . .  	L NEAR	005F	_TEXT
serial_int . . . . . . . . . . .  	F PROC	0000	_TEXT	Length = 0082
serial_restore_bios_data . . . .  	L NEAR	0125	_TEXT
serial_search  . . . . . . . . .  	N PROC	0142	_TEXT	Global	Length = 003A
set_next_packet  . . . . . . . .  	L NEAR	005B	_TEXT
set_packet_1 . . . . . . . . . .  	L NEAR	0059	_TEXT

test_card  . . . . . . . . . . .  	N PROC	017C	_TEXT	Global	Length = 00CC
test_loop  . . . . . . . . . . .  	N PROC	0248	_TEXT	Global	Length = 0096

unhook_us  . . . . . . . . . . .  	L NEAR	0000		External

VMD_DEVICE_ID  . . . . . . . . .  	NUMBER	000C	
vector . . . . . . . . . . . . .  	V BYTE	0000	_DATA	External

WF_PMODE . . . . . . . . . . . .  	NUMBER	0001	
wptr . . . . . . . . . . . . . .  	TEXT  word ptr		

X_SPEED  . . . . . . . . . . . .  	NUMBER	0002	
x_or_y . . . . . . . . . . . . .  	L NEAR	002B	_TEXT

Y_SPEED  . . . . . . . . . . . .  	NUMBER	0002	

zero_bios_port . . . . . . . . .  	L NEAR	00BD	_TEXT
Microsoft (R) Macro Assembler Version 5.10A                 1/7/26 00:09:10

8250 Serial Mouse Hardware Dependent Code                   Symbols-5



?386regs . . . . . . . . . . . .  	NUMBER	0000	
@Cpu . . . . . . . . . . . . . .  	TEXT  1415		
@FileName  . . . . . . . . . . .  	TEXT  ser8250		
@Version . . . . . . . . . . . .  	TEXT  510		
__ROMBIOS  . . . . . . . . . . .  	NUMBER	0000		Communal


   2506 Source  Lines
   3485 Total   Lines
    377 Symbols

  46024 Bytes symbol space free

      0 Warning Errors
      0 Severe  Errors
